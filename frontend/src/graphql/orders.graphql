query BuyerOrders($skip: Int, $take: Int, $status: String, $search: String) {
  orders(skip: $skip, take: $take, status: $status, search: $search) {
    id
    orderNumber
    quantity
    targetPrice
    currency
    deadline
    status
    notes
    createdAt
    updatedAt
    collection {
      id
      name
      modelCode
      images
      targetPrice
      currency
      company {
        id
        name
      }
    }
    customer {
      id
      name
      email
    }
    manufacturer {
      id
      name
      email
    }
  }
}

query BuyerOrderDetail($id: Int!) {
  order(id: $id) {
    id
    orderNumber
    quantity
    targetPrice
    currency
    deadline
    status
    notes
    unitPrice
    productionDays
    manufacturerResponse
    actualProductionStart
    createdAt
    updatedAt
    collection {
      id
      name
      description
      modelCode
      season
      gender
      fit
      trend
      colors
      sizeRange
      fabricComposition
      accessories
      images
      moq
      targetPrice
      currency
      deadlineDays
      notes
      company {
        id
        name
        email
        phone
        address
        city
        country
        website
      }
    }
    customer {
      id
      name
      email
      phone
      company {
        id
        name
        email
        phone
        address
        city
        country
      }
    }
    manufacturer {
      id
      name
      email
      phone
      company {
        id
        name
        email
        phone
        address
        city
        country
      }
    }
    productionTracking {
      id
      currentStage
      overallStatus
      progress
      estimatedStartDate
      estimatedEndDate
      actualStartDate
      actualEndDate
      notes
      customerApprovalStatus
      customerApprovedAt
      customerNote
      revisionCount
      stageUpdates {
        id
        stage
        status
        actualStartDate
        actualEndDate
        estimatedDays
        notes
        extraDays
        isRevision
        delayReason
      }
    }
    changeLogs {
      id
      changeType
      previousValues
      newValues
      changeReason
      manufacturerStatus
      manufacturerResponse
      manufacturerReviewedAt
      negotiationTriggered
      createdAt
      changedByUser {
        id
        name
        email
      }
      reviewedByUser {
        id
        name
        email
      }
    }
  }
}

# Customer sends counter offer
mutation CustomerCounterOffer(
  $id: Int!
  $customerQuotedPrice: Float!
  $customerQuoteDays: Int
  $customerQuoteNote: String
) {
  updateOrder(
    id: $id
    customerQuotedPrice: $customerQuotedPrice
    customerQuoteDays: $customerQuoteDays
    customerQuoteNote: $customerQuoteNote
    status: "CUSTOMER_NEGOTIATING"
  ) {
    id
    orderNumber
    status
    customerQuotedPrice
    customerQuoteDays
    customerQuoteNote
  }
}

# Customer accepts manufacturer quote
mutation CustomerAcceptQuote($id: Int!) {
  updateOrder(id: $id, status: "CONFIRMED") {
    id
    orderNumber
    status
  }
}

# Customer rejects manufacturer quote
mutation CustomerRejectQuote($id: Int!) {
  updateOrder(id: $id, status: "REJECTED") {
    id
    orderNumber
    status
  }
}

# Manufacturer accepts customer quote (direct acceptance)
mutation ManufacturerAcceptCustomerQuote($orderId: Int!) {
  manufacturerAcceptCustomerQuote(orderId: $orderId) {
    id
    orderNumber
    status
    unitPrice
    productionDays
  }
}

# Create Production Plan
mutation CreateProductionPlan(
  $orderId: Int!
  $stagesJson: String!
  $estimatedStartDate: DateTime
  $notes: String
) {
  createProductionPlan(
    orderId: $orderId
    stagesJson: $stagesJson
    estimatedStartDate: $estimatedStartDate
    notes: $notes
  ) {
    id
    currentStage
    overallStatus
    progress
    estimatedStartDate
    estimatedEndDate
    notes
    customerApprovalStatus
  }
}

# Update Production Plan
mutation UpdateProductionPlan(
  $productionId: Int!
  $stagesJson: String!
  $notes: String
) {
  updateProductionPlan(
    productionId: $productionId
    stagesJson: $stagesJson
    notes: $notes
  ) {
    id
    currentStage
    overallStatus
    progress
    estimatedStartDate
    estimatedEndDate
    notes
    customerApprovalStatus
    revisionCount
  }
}

# Send Production Plan for Customer Approval
mutation SendProductionPlanForApproval($productionId: Int!) {
  sendProductionPlanForApproval(productionId: $productionId) {
    id
    customerApprovalStatus
    currentStage
    overallStatus
  }
}

# Customer Response to Production Plan
mutation RespondToProductionPlan(
  $productionId: Int!
  $approved: Boolean!
  $customerNote: String
) {
  respondToProductionPlan(
    productionId: $productionId
    approved: $approved
    customerNote: $customerNote
  ) {
    id
    customerApprovalStatus
    customerApprovedAt
    customerNote
    currentStage
    overallStatus
  }
}

# Order Change Tracking Operations

# Track order update (customers when they modify orders)
mutation TrackOrderUpdate(
  $orderId: Int!
  $changeType: OrderChangeType!
  $previousValues: JSON!
  $newValues: JSON!
  $changeReason: String
) {
  trackOrderUpdate(
    orderId: $orderId
    changeType: $changeType
    previousValues: $previousValues
    newValues: $newValues
    changeReason: $changeReason
  ) {
    id
    changeType
    manufacturerStatus
    negotiationTriggered
    createdAt
  }
}

# Review order change (manufacturers respond to customer changes)
mutation ReviewOrderChange(
  $changeLogId: Int!
  $status: OrderChangeLogStatus!
  $response: String
  $triggerNegotiation: Boolean
) {
  reviewOrderChange(
    changeLogId: $changeLogId
    status: $status
    response: $response
    triggerNegotiation: $triggerNegotiation
  ) {
    id
    manufacturerStatus
    manufacturerResponse
    manufacturerReviewedAt
    negotiationTriggered
  }
}

# Query order change logs for an order
query OrderChangeLogs($orderId: Int!, $skip: Int, $take: Int) {
  orderChangeLogs(orderId: $orderId, skip: $skip, take: $take) {
    id
    changeType
    previousValues
    newValues
    changeReason
    manufacturerStatus
    manufacturerResponse
    manufacturerReviewedAt
    negotiationTriggered
    createdAt
    changedByUser {
      id
      name
      email
    }
    reviewedByUser {
      id
      name
      email
    }
    relatedNegotiation {
      id
      status
    }
  }
}
