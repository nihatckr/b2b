// ========================================
// ðŸ”§ REFACTORING / BACKUP AREA
// ========================================
// Bu dosya, server/prisma/schema.prisma dosyasÄ±nÄ±n
// yedek/refactoring versiyonudur.
//
// âš ï¸ AKTÄ°F KULLANIM: server/prisma/schema.prisma
// ðŸ“ YEDEK/TEST: backend/prisma/schema.prisma (Bu dosya)
//
// Son Senkronizasyon: 18 Ekim 2025
// ========================================

generator client {
  provider = "prisma-client-js"
  output   = "../lib/generated/prisma"
}

generator pothos {
  provider     = "prisma-pothos-types"
  clientOutput = "./prisma" // relative path from pothos output to prisma client
  output       = "../lib/pothos-prisma-types.ts"
}

datasource db {
  provider = "mysql"
  url      = env("DATABASE_URL")
}

// ========================================
// ðŸ‘¥ USER ROLES & PERMISSIONS
// ========================================
enum Role {
  ADMIN // Platform admin (Siz - full system access)
  COMPANY_OWNER // Firma sahibi (Full access kendi ÅŸirketi iÃ§in)
  COMPANY_EMPLOYEE // Firma Ã§alÄ±ÅŸanÄ± (Department-based permissions)
  INDIVIDUAL_CUSTOMER // Bireysel mÃ¼ÅŸteri (Limited access, firma olmadan)

  // Backward compatibility (deprecated - will be removed in future)
  MANUFACTURE
  CUSTOMER
}

// Department-based roles for COMPANY_EMPLOYEE
enum Department {
  PURCHASING // SatÄ±n Alma (Order oluÅŸturma, Sample sipariÅŸ)
  PRODUCTION // Ãœretim (Sample Ã¼retimi, Production tracking)
  QUALITY // Kalite Kontrol (QA, Inspection)
  DESIGN // TasarÄ±m (Collection, Sample design)
  SALES // SatÄ±ÅŸ (Customer relations, Order management)
  MANAGEMENT // YÃ¶netim (Full access, reports)
}

enum CompanyType {
  MANUFACTURER // Ãœretici firma (Ã–rn: Defacto - sadece Ã¼retim yapar)
  BUYER // AlÄ±cÄ± firma (Ã–rn: LC Waikiki - sadece sipariÅŸ verir)
  BOTH // Hybrid firma (Ã–rn: Zara - hem Ã¼retir hem alÄ±r)
}

// ========================================
// ðŸ’³ SUBSCRIPTION & BILLING (SaaS Ready)
// ========================================
enum SubscriptionPlan {
  FREE // Ãœcretsiz (Trial) - Limited features
  STARTER // BaÅŸlangÄ±Ã§ ($29/ay) - Small teams
  PROFESSIONAL // Profesyonel ($99/ay) - Growing businesses
  ENTERPRISE // Kurumsal ($299/ay) - Large companies
  CUSTOM // Ã–zel anlaÅŸma (Custom pricing)
}

enum SubscriptionStatus {
  TRIAL // Deneme sÃ¼rÃ¼mÃ¼ (14 gÃ¼n)
  ACTIVE // Aktif abonelik
  PAST_DUE // Ã–deme gecikmiÅŸ
  CANCELLED // Ä°ptal edilmiÅŸ
  EXPIRED // SÃ¼resi dolmuÅŸ
}

enum BillingCycle {
  MONTHLY // AylÄ±k Ã¶deme
  YEARLY // YÄ±llÄ±k Ã¶deme (%20 indirimli)
}

// Tekstil Enums
enum Season {
  SS25 // Spring/Summer 2025
  FW25 // Fall/Winter 2025
  SS26 // Spring/Summer 2026
  FW26 // Fall/Winter 2026
  SS27
  FW27
}

enum Gender {
  WOMEN // KadÄ±n
  MEN // Erkek
  GIRLS // KÄ±z Ã‡ocuk
  BOYS // Erkek Ã‡ocuk
  UNISEX // Unisex
}

enum Fit {
  REGULAR // Regular
  SLIM // Slim
  RELAXED // Relaxed
  OVERSIZED // Oversized
  FITTED // Fitted
  LOOSE // Loose
}

model Company {
  id          Int         @id @default(autoincrement())
  name        String
  email       String      @unique
  phone       String?
  address     String?
  location    String? // Åžehir/BÃ¶lge: "Ä°stanbul", "Ä°zmir", "Denizli"
  website     String?
  type        CompanyType @default(MANUFACTURER)
  description String?     @db.Text

  // Owner
  owner   User? @relation("CompanyOwner", fields: [ownerId], references: [id])
  ownerId Int?  @unique

  isActive Boolean @default(true)
  settings Json? // Company-wide settings

  // ========================================
  // ðŸŽ¨ BRANDING & PROFILE (Frontend)
  // ========================================
  logo        String? // Company logo URL: "/uploads/logos/company123.png"
  coverImage  String? // Banner/Cover image: "/uploads/covers/company123.jpg"
  brandColors Json? // { primary: "#FF5733", secondary: "#333333", accent: "#00FF00" }

  // Social & Contact
  socialLinks Json? // { website: "url", linkedin: "url", instagram: "url", facebook: "url" }

  // Public Profile
  isPublicProfile Boolean @default(false) // Public company profile page
  profileSlug     String? @unique // SEO-friendly URL: /company/defacto

  // ========================================
  // ðŸ’³ SUBSCRIPTION & BILLING
  // ========================================
  subscriptionPlan   SubscriptionPlan   @default(FREE)
  subscriptionStatus SubscriptionStatus @default(TRIAL)
  billingCycle       BillingCycle       @default(MONTHLY)

  // Usage Limits (Plan-based)
  maxUsers       Int   @default(3) // FREE: 3, STARTER: 10, PRO: 50, ENTERPRISE: unlimited
  maxSamples     Int   @default(10) // FREE: 10, STARTER: 100, PRO: 500, ENTERPRISE: unlimited
  maxOrders      Int   @default(5) // FREE: 5, STARTER: 50, PRO: 200, ENTERPRISE: unlimited
  maxCollections Int   @default(5) // FREE: 5, STARTER: 20, PRO: 100, ENTERPRISE: unlimited
  maxStorageGB   Float @default(1.0) // FREE: 1GB, STARTER: 10GB, PRO: 100GB, ENTERPRISE: 1TB

  // Current Usage (Auto-calculated)
  currentUsers       Int   @default(0)
  currentSamples     Int   @default(0)
  currentOrders      Int   @default(0)
  currentCollections Int   @default(0)
  currentStorageGB   Float @default(0.0)

  // Trial Period
  trialStartedAt DateTime? @default(now())
  trialEndsAt    DateTime? // Auto-set to +14 days on signup

  // Billing Info
  billingEmail   String?
  taxId          String? // Vergi no
  billingAddress String? @db.Text

  // Subscription Dates
  subscriptionStartedAt DateTime?
  currentPeriodStart    DateTime?
  currentPeriodEnd      DateTime?

  // Cancellation
  cancelAtPeriodEnd Boolean   @default(false)
  cancelledAt       DateTime?

  // BOTH type iÃ§in Ã¶zel ayarlar
  defaultView    String? // "MANUFACTURER" | "BUYER" (BOTH iÃ§in hangi gÃ¶rÃ¼nÃ¼m default)
  enabledModules Json? // { manufacturing: true, purchasing: true } (Hangi modÃ¼ller aktif)

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  // Relations
  employees          User[]               @relation("CompanyEmployees")
  categories         Category[]
  collections        Collection[]
  samples            Sample[]
  orders             Order[]
  productionTracking ProductionTracking[]
  messages           Message[]

  // Library Management
  colors         Color[]
  fabrics        Fabric[]
  sizeGroups     SizeGroup[]
  seasons        SeasonItem[]
  fits           FitItem[]
  certifications Certification[]

  // ========================================
  // PERFORMANCE INDEXES
  // ========================================
  @@index([email]) // Email lookup
  @@index([type, isActive]) // Company type + active filter
  @@index([isActive, createdAt]) // Active companies with sorting
  @@index([location]) // Location filter
  @@index([ownerId]) // Owner lookup
  @@index([subscriptionPlan]) // Plan-based queries
  @@index([subscriptionStatus]) // Active subscriptions
  @@index([trialEndsAt]) // Expiring trials
  @@index([currentPeriodEnd]) // Expiring subscriptions
  @@index([profileSlug]) // Public profile lookup
  @@index([isPublicProfile]) // Public companies filter
  // Full-text search (MySQL)
  @@fulltext([name, description])
  @@map("companies")
}

model Message {
  id         Int     @id @default(autoincrement())
  content    String  @db.Text
  senderId   Int
  receiverId Int? // AlÄ±cÄ± kullanÄ±cÄ± ID
  isRead     Boolean @default(false)
  type       String  @default("general") // "order", "sample", "general"

  // ÃœrÃ¼n bazlÄ± mesajlaÅŸma
  orderId  Int?
  sampleId Int?

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  // Relations
  sender    User     @relation("SentMessages", fields: [senderId], references: [id], onDelete: Cascade)
  receiver  User?    @relation("ReceivedMessages", fields: [receiverId], references: [id], onDelete: Cascade)
  order     Order?   @relation(fields: [orderId], references: [id], onDelete: Cascade)
  sample    Sample?  @relation(fields: [sampleId], references: [id], onDelete: Cascade)
  company   Company? @relation(fields: [companyId], references: [id])
  companyId Int?

  // ========================================
  // PERFORMANCE INDEXES
  // ========================================
  @@index([senderId, createdAt]) // Sender messages with sorting
  @@index([receiverId, isRead]) // Unread messages
  @@index([receiverId, createdAt]) // Receiver messages with sorting
  @@index([orderId]) // Order messages
  @@index([sampleId]) // Sample messages
  @@index([companyId, createdAt]) // Company messages
  @@index([type, isRead]) // Type + read status
  @@index([senderId, receiverId]) // Conversation lookup
  @@map("messages")
}

model ProductionTracking {
  id       Int  @id @default(autoincrement())
  orderId  Int?
  sampleId Int?

  currentStage  ProductionStage  @default(PLANNING)
  overallStatus ProductionStatus @default(IN_PROGRESS)
  progress      Int              @default(0) // 0-100%

  estimatedStartDate DateTime?
  estimatedEndDate   DateTime?
  actualStartDate    DateTime?
  actualEndDate      DateTime?

  notes String? @db.Text

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  // Relations
  order     Order?   @relation(fields: [orderId], references: [id])
  sample    Sample?  @relation(fields: [sampleId], references: [id])
  company   Company? @relation(fields: [companyId], references: [id])
  companyId Int?

  // New relations
  sewingWorkshop      Workshop? @relation("SewingWorkshop", fields: [sewingWorkshopId], references: [id])
  sewingWorkshopId    Int?
  packagingWorkshop   Workshop? @relation("PackagingWorkshop", fields: [packagingWorkshopId], references: [id])
  packagingWorkshopId Int?

  stageUpdates        ProductionStageUpdate[]
  qualityControls     QualityControl[]
  productionRevisions ProductionRevision[]
  revisions           Revision[] // Legacy
  tasks               Task[]                  @relation("ProductionTrackingTasks")
  notifications       Notification[]          @relation("ProductionNotifications")

  @@map("production_tracking")
}

model Revision {
  id                   Int       @id @default(autoincrement())
  orderId              Int?
  sampleId             Int?
  productionTrackingId Int?
  revisionNumber       Int       @default(1)
  requestMessage       String?
  responseMessage      String?
  status               String    @default("pending")
  requestedAt          DateTime  @default(now())
  completedAt          DateTime?
  createdAt            DateTime  @default(now())
  updatedAt            DateTime  @updatedAt

  // Relations
  order              Order?              @relation(fields: [orderId], references: [id])
  sample             Sample?             @relation(fields: [sampleId], references: [id])
  productionTracking ProductionTracking? @relation(fields: [productionTrackingId], references: [id])

  @@map("revisions")
}

model User {
  id        Int     @id @default(autoincrement())
  email     String  @unique
  password  String
  name      String?
  username  String? @unique
  firstName String?
  lastName  String?
  phone     String?

  // Company & Role
  company   Company? @relation("CompanyEmployees", fields: [companyId], references: [id])
  companyId Int?
  role      Role     @default(INDIVIDUAL_CUSTOMER)

  // Company Ownership & Permissions
  isCompanyOwner Boolean     @default(false)
  department     Department? // Department for COMPANY_EMPLOYEE role
  jobTitle       String? // "MÃ¼dÃ¼r", "Uzman", "KoordinatÃ¶r"

  // ========================================
  // ï¿½ PROFILE & UI (Frontend)
  // ========================================
  avatar      String? // Profile picture URL: "/uploads/avatars/user123.jpg"
  bio         String? @db.Text // User bio/description
  socialLinks Json? // { linkedin: "url", twitter: "url", instagram: "url" }

  // User Settings
  emailNotifications Boolean @default(true) // Email bildirimlerini al
  pushNotifications  Boolean @default(false) // Push notification
  language           String  @default("tr") // UI dili: "tr", "en"
  timezone           String  @default("Europe/Istanbul") // Saat dilimi

  // ========================================
  // ï¿½ðŸ” PERMISSIONS (Typed JSON)
  // ========================================
  // Format: UserPermissions type (see types/permissions.ts)
  // Example:
  // {
  //   samples: { create: true, edit: true, delete: false, viewAll: false },
  //   orders: { create: true, approve: false, cancel: false, viewAll: false },
  //   users: { invite: false, remove: false, changeRole: false },
  //   billing: { view: false, upgrade: false, managePlan: false },
  //   production: { viewAll: true, updateStage: true, qaControl: false },
  //   collections: { create: true, edit: true, delete: false, publish: false }
  // }
  permissions Json? // Detailed permission object (overrides role defaults)

  // Status
  isActive          Boolean @default(true)
  isPendingApproval Boolean @default(false)

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  // Owned Companies
  ownedCompanies Company[] @relation("CompanyOwner")

  // Messages relation
  sentMessages     Message[]    @relation("SentMessages")
  receivedMessages Message[]    @relation("ReceivedMessages")
  categories       Category[]
  collections      Collection[]

  // Customer relations
  customerSamples   Sample[]   @relation("CustomerSamples")
  customerOrders    Order[]    @relation("CustomerOrders")
  customerQuestions Question[] @relation("CustomerQuestions")
  customerReviews   Review[]   @relation("CustomerReviews")

  // Manufacture relations
  manufactureSamples      Sample[]           @relation("ManufactureSamples")
  manufactureOrders       Order[]            @relation("ManufactureOrders")
  manufactureQuestions    Question[]         @relation("ManufactureQuestions")
  sampleProductionUpdates SampleProduction[]
  orderProductionUpdates  OrderProduction[]  @relation("OrderProductionUpdates")

  // Production system relations
  qualityInspections QualityControl[]     @relation("QualityInspector")
  ownedWorkshops     Workshop[]           @relation("WorkshopOwner")
  revisionRequests   ProductionRevision[] @relation("RevisionRequester")

  // Favorites/Likes
  favoriteCollections UserFavoriteCollection[]

  // Notifications
  notifications Notification[] @relation("UserNotifications")

  // Tasks
  tasks         Task[] @relation("UserTasks")
  assignedTasks Task[] @relation("AssignedTasks")

  // ========================================
  // PERFORMANCE INDEXES
  // ========================================
  @@index([email]) // Email lookup
  @@index([username]) // Username lookup
  @@index([companyId, role]) // Company users by role
  @@index([companyId, isActive]) // Company active users
  @@index([companyId, department]) // Company users by department
  @@index([role, isActive]) // Role + active filter
  @@index([isActive]) // Active users
  @@index([isPendingApproval]) // Pending approval filter
  @@index([createdAt]) // Date sorting
  @@map("users")
}

model Category {
  id               Int          @id @default(autoincrement())
  createdAt        DateTime     @default(now())
  updatedAt        DateTime     @updatedAt
  name             String // ArtÄ±k unique deÄŸil - farklÄ± parent'lar altÄ±nda aynÄ± isim olabilir
  description      String?
  author           User?        @relation(fields: [authorId], references: [id])
  authorId         Int?
  collections      Collection[]
  subCategories    Category[]   @relation("CategoryToSubCategories")
  parentCategory   Category?    @relation("CategoryToSubCategories", fields: [parentCategoryId], references: [id])
  parentCategoryId Int?

  // Company relation
  company   Company? @relation(fields: [companyId], references: [id])
  companyId Int?

  // AynÄ± ÅŸirket, aynÄ± parent altÄ±nda aynÄ± isim olamaz
  @@unique([companyId, parentCategoryId, name])
  @@map("categories")
}

model Collection {
  id          Int      @id @default(autoincrement())
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt
  name        String
  description String?

  // ADIM 1: Temel Bilgiler
  modelCode String  @unique // THS-2024-00
  season    Season? // SS25, FW25, SS26, FW26
  // klasman -> category ile handle edilecek (GÃ¶mlek, Pantolon, Triko)
  gender    Gender? // KadÄ±n, Erkek, KÄ±z Ã‡ocuk, Erkek Ã‡ocuk
  fit       String? // Library'den seÃ§ilen fit adÄ±: "Slim Fit", "Regular Fit", "Relaxed Fit"
  trend     String? // Trend adÄ±: "Minimalist", "Vintage", "Sport Chic", "Y2K"

  // ADIM 2: Varyantlar ve Ã–lÃ§Ã¼ler
  colors           String? // JSON array: ["beyaz", "siyah", "yeÅŸil"]
  sizeGroups       String? // JSON array of group IDs: [1, 2, 3] - Birden fazla beden grubu (pantolon + gÃ¶mlek)
  sizeRange        String? // Manuel override: "S-XL" veya "6-16" (legacy)
  measurementChart String? // File path: /uploads/measurements/xxx.pdf

  // ADIM 3: Teknik Detaylar
  fabricComposition String? // "%100 Cotton" veya "80% Cotton 20% Polyester"
  accessories       String? @db.Text // JSON: {"buttons": "metal", "zipper": "YKK", "labels": "woven"}
  images            String? @db.Text // JSON array: ["/uploads/products/img1.jpg", ...] or ["https://..."]
  techPack          String? // File path: /uploads/techpacks/xxx.pdf

  // ADIM 4: Ticari Bilgiler
  moq            Int? // Minimum Order Quantity
  targetPrice    Float? // Hedef fiyat (USD)
  targetLeadTime Int? // Hedef termin (gÃ¼n)
  notes          String? @db.Text // AÃ§Ä±klama/Notlar

  // Sertifikalar (GOTS, OEKO-TEX, BSCI vb.)
  certifications Certification[] @relation("CollectionCertifications")

  // BeÄŸeni/Favoriler
  likesCount  Int                      @default(0) // Toplam beÄŸeni sayÄ±sÄ±
  favoritedBy UserFavoriteCollection[] // BeÄŸenen kullanÄ±cÄ±lar

  // ========================================
  // ðŸ“Š ANALYTICS & ENGAGEMENT (Frontend)
  // ========================================
  viewCount    Int       @default(0) // KaÃ§ kere gÃ¶rÃ¼ntÃ¼lendi
  shareCount   Int       @default(0) // KaÃ§ kere paylaÅŸÄ±ldÄ±
  lastViewedAt DateTime? // Son gÃ¶rÃ¼ntÃ¼lenme zamanÄ±

  // Legacy fields (backward compatibility)
  price      Float   @default(0.00) // Åžimdilik targetPrice ile aynÄ±
  sku        String? @unique
  stock      Int     @default(0)
  isActive   Boolean @default(true)
  isFeatured Boolean @default(false)
  slug       String? @unique

  // Production Schedule - Her aÅŸama iÃ§in standart gÃ¼n sayÄ±sÄ±
  productionSchedule Json? // { "PLANNING": 5, "FABRIC": 3, "CUTTING": 2, "SEWING": 10, "QUALITY": 2, "PACKAGING": 2, "SHIPPING": 1 }

  category   Category? @relation(fields: [categoryId], references: [id])
  categoryId Int?
  author     User?     @relation(fields: [authorId], references: [id]) // Ãœretici
  authorId   Int?

  // Relations
  samples        Sample[]   @relation("SampleCollection")
  revisedSamples Sample[]   @relation("OriginalCollection") // Bu Ã¼rÃ¼n iÃ§in yapÄ±lan revize numuneleri
  orders         Order[]
  questions      Question[]
  reviews        Review[]
  tasks          Task[]     @relation("CollectionTasks")

  // Company relation
  company   Company? @relation(fields: [companyId], references: [id])
  companyId Int?

  // ========================================
  // PERFORMANCE INDEXES
  // ========================================
  @@index([companyId, isActive]) // Company active collections
  @@index([authorId]) // Author collections
  @@index([categoryId]) // Category filter
  @@index([season]) // Season filter
  @@index([gender]) // Gender filter
  @@index([isFeatured]) // Featured collections
  @@index([isActive, createdAt]) // Active collections with sorting
  @@index([slug]) // Slug lookup
  @@index([modelCode]) // Model code lookup
  @@index([createdAt]) // Date sorting
  @@index([viewCount]) // Popular collections (most viewed)
  @@index([likesCount]) // Popular collections (most liked)
  // Full-text search (MySQL)
  @@fulltext([name, description])
  @@map("collections")
}

// User Favorite Collections (Junction Table for Likes)
model UserFavoriteCollection {
  id        Int      @id @default(autoincrement())
  createdAt DateTime @default(now())

  user   User @relation(fields: [userId], references: [id], onDelete: Cascade)
  userId Int

  collection   Collection @relation(fields: [collectionId], references: [id], onDelete: Cascade)
  collectionId Int

  @@unique([userId, collectionId])
  @@index([userId])
  @@index([collectionId])
  @@map("user_favorite_collections")
}

// Numune talep ve Ã¼retim sistemi
model Sample {
  id                   Int          @id @default(autoincrement())
  createdAt            DateTime     @default(now())
  updatedAt            DateTime     @updatedAt
  sampleNumber         String       @unique // Numune takip numarasÄ±
  sampleType           SampleType   @default(STANDARD) // Numune tipi
  status               SampleStatus @default(REQUESTED)
  customerNote         String?      @db.Text // MÃ¼ÅŸteri talep notu
  manufacturerResponse String?      @db.Text // Ãœretici yanÄ±tÄ±/deÄŸerlendirme

  // Revize/Ã–zelleÅŸtirme bilgileri (CUSTOM ve REVISION tipleri iÃ§in)
  customDesignImages   String? @db.Text // MÃ¼ÅŸteri tasarÄ±m gÃ¶rselleri (JSON)
  revisionRequests     String? // Revize istekleri (JSON: [{field, oldValue, newValue, note}])
  originalCollectionId Int? // Revize edilecek orijinal Ã¼rÃ¼n ID'si

  // AI Generated Sample fields
  name        String? // Sample name
  description String?  @db.Text // Sample description (long text)
  images      String?  @db.Text // JSON array of image URLs
  aiGenerated Boolean? @default(false) // Is this an AI-generated sample
  aiPrompt    String?  @db.Text // The prompt used for AI generation
  aiSketchUrl String? // The sketch/reference image URL used

  // Ãœretim sÃ¼reci bilgileri
  unitPrice               Float? // Numune birim fiyatÄ±
  productionDays          Int? // Ãœretici: "X gÃ¼nde Ã¼retebilirim"
  estimatedProductionDate DateTime? // Hesaplanan Ã¼retim tarihi
  actualProductionDate    DateTime? // GerÃ§ek Ã¼retim tamamlanma tarihi
  shippingDate            DateTime? // Kargoya veriliÅŸ tarihi
  deliveryAddress         String? // Teslimat adresi
  cargoTrackingNumber     String? // Kargo takip numarasÄ± (opsiyonel)

  // MÃ¼ÅŸteri Teklif Bilgileri (Order ile aynÄ±)
  customerQuotedPrice Float? // MÃ¼ÅŸterinin teklif ettiÄŸi fiyat
  customerQuoteDays   Int? // MÃ¼ÅŸterinin istediÄŸi Ã¼retim sÃ¼resi (gÃ¼n)
  customerQuoteNote   String?   @db.Text // MÃ¼ÅŸterinin teklif notu/aÃ§Ä±klamasÄ±
  customerQuoteType   String? // "STANDARD" (standartlara uygun) veya "REVISION" (revize teklif)
  customerQuoteSentAt DateTime? // MÃ¼ÅŸteri teklifi gÃ¶nderme zamanÄ±

  collection         Collection?          @relation("SampleCollection", fields: [collectionId], references: [id])
  collectionId       Int?
  originalCollection Collection?          @relation("OriginalCollection", fields: [originalCollectionId], references: [id])
  customer           User                 @relation("CustomerSamples", fields: [customerId], references: [id])
  customerId         Int
  manufacture        User                 @relation("ManufactureSamples", fields: [manufactureId], references: [id])
  manufactureId      Int
  productionHistory  SampleProduction[] // Ãœretim geÃ§miÅŸi takibi
  productionTracking ProductionTracking[]
  revisions          Revision[]
  messages           Message[] // Numune bazlÄ± mesajlaÅŸma

  // Company relation
  company   Company? @relation(fields: [companyId], references: [id])
  companyId Int?

  // AI Analysis relation
  aiAnalysis AIAnalysis?

  // Tasks
  tasks Task[] @relation("SampleTasks")

  // Notifications
  notifications Notification[] @relation("SampleNotifications")

  // ========================================
  // ðŸ“Š ANALYTICS & ENGAGEMENT (Frontend)
  // ========================================
  viewCount    Int       @default(0) // KaÃ§ kere gÃ¶rÃ¼ntÃ¼lendi
  shareCount   Int       @default(0) // KaÃ§ kere paylaÅŸÄ±ldÄ±
  lastViewedAt DateTime? // Son gÃ¶rÃ¼ntÃ¼lenme zamanÄ±

  // ========================================
  // PERFORMANCE INDEXES
  // ========================================
  @@index([status]) // Status filtering
  @@index([customerId, status]) // Customer samples by status
  @@index([manufactureId, status]) // Manufacturer samples by status
  @@index([companyId, status, createdAt]) // Company samples with sorting
  @@index([collectionId]) // Collection relation
  @@index([sampleNumber]) // Unique lookup
  @@index([sampleType, status]) // Type + status filter
  @@index([aiGenerated]) // AI generated samples filter
  @@index([createdAt]) // Date sorting
  @@index([status, createdAt]) // Status + date combination
  @@index([viewCount]) // Popular samples (most viewed)
  @@map("samples")
}

// AI Analiz SonuÃ§larÄ± (Numune ile iliÅŸkili)
model AIAnalysis {
  id        Int      @id @default(autoincrement())
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  // Temel Analiz SonuÃ§larÄ± (Form'a yazÄ±lan)
  detectedProduct        String? // Tespit edilen Ã¼rÃ¼n tÃ¼rÃ¼
  detectedColor          String? // Tespit edilen renk
  detectedFabric         String? // Tespit edilen kumaÅŸ
  detectedPattern        String? // Tespit edilen kalÄ±p
  detectedGender         String? // Tespit edilen cinsiyet
  detectedClassification String? // Tespit edilen klasman
  detectedAccessories    String? // Tespit edilen aksesuarlar
  technicalDescription   String? @db.Text // Teknik aÃ§Ä±klama

  // Kalite Analizi
  qualityAnalysis String? @db.Text // Kalite analiz raporu
  qualityScore    Float? // Genel kalite skoru (1-10)

  // Maliyet Analizi
  costAnalysis      String? @db.Text // Maliyet analiz raporu
  estimatedCostMin  Float? // Tahmini minimum maliyet (â‚º)
  estimatedCostMax  Float? // Tahmini maksimum maliyet (â‚º)
  suggestedMinOrder Int? // Ã–nerilen minimum sipariÅŸ adedi

  // Trend Analizi
  trendAnalysis  String? @db.Text // Trend analiz raporu
  trendScore     Float? // Trend skoru (1-10)
  targetMarket   String? // Hedef pazar segmenti
  salesPotential String? // SatÄ±ÅŸ potansiyeli (LOW/MEDIUM/HIGH)

  // TasarÄ±m Ã–nerileri
  designSuggestions String? @db.Text // TasarÄ±m Ã¶nerileri (JSON veya text)
  designStyle       String? // SeÃ§ilen stil yÃ¶nÃ¼
  designFocus       String? // OdaklanÄ±lan alanlar (JSON array)

  // Ä°liÅŸki
  sample   Sample @relation(fields: [sampleId], references: [id], onDelete: Cascade)
  sampleId Int    @unique

  @@map("ai_analyses")
}

// Numune Ã¼retim geÃ§miÅŸi takibi
model SampleProduction {
  id            Int          @id @default(autoincrement())
  createdAt     DateTime     @default(now())
  status        SampleStatus
  note          String? // Ãœretici aÃ§Ä±klamasÄ±
  estimatedDays Int? // Bu aÅŸama iÃ§in tahmini gÃ¼n
  actualDate    DateTime? // Bu aÅŸamanÄ±n gerÃ§ek tamamlanma tarihi
  sample        Sample       @relation(fields: [sampleId], references: [id])
  sampleId      Int
  updatedBy     User         @relation(fields: [updatedById], references: [id])
  updatedById   Int
}

// SipariÅŸ ve Ã¼retim sistemi
model Order {
  id                   Int         @id @default(autoincrement())
  createdAt            DateTime    @default(now())
  updatedAt            DateTime    @updatedAt
  orderNumber          String      @unique
  quantity             Int
  unitPrice            Float // Birim fiyat
  totalPrice           Float // Toplam fiyat
  status               OrderStatus @default(PENDING)
  customerNote         String? // MÃ¼ÅŸteri sipariÅŸ notu
  manufacturerResponse String? // Ãœretici yanÄ±tÄ±/deÄŸerlendirme

  // MÃ¼ÅŸteri Teklif Bilgileri
  customerQuotedPrice Float? // MÃ¼ÅŸterinin teklif ettiÄŸi birim fiyat
  customerQuoteDays   Int? // MÃ¼ÅŸterinin istediÄŸi Ã¼retim sÃ¼resi (gÃ¼n)
  customerQuoteNote   String?   @db.Text // MÃ¼ÅŸterinin teklif notu/aÃ§Ä±klamasÄ±
  customerQuoteType   String? // "STANDARD" (standartlara uygun) veya "REVISION" (revize teklif)
  customerQuoteSentAt DateTime? // MÃ¼ÅŸteri teklifi gÃ¶nderme zamanÄ±

  // Ãœretim sÃ¼reci bilgileri
  productionDays          Int? // Ãœretici: "X gÃ¼nde Ã¼retebilirim"
  estimatedProductionDate DateTime? // Hesaplanan Ã¼retim tarihi
  actualProductionStart   DateTime? // GerÃ§ek Ã¼retime baÅŸlama tarihi
  actualProductionEnd     DateTime? // GerÃ§ek Ã¼retim bitiÅŸ tarihi
  shippingDate            DateTime? // Kargoya veriliÅŸ tarihi
  deliveryAddress         String? // Teslimat adresi
  cargoTrackingNumber     String? // Kargo takip numarasÄ±

  collection         Collection           @relation(fields: [collectionId], references: [id])
  collectionId       Int
  customer           User                 @relation("CustomerOrders", fields: [customerId], references: [id])
  customerId         Int
  manufacture        User                 @relation("ManufactureOrders", fields: [manufactureId], references: [id])
  manufactureId      Int
  productionHistory  OrderProduction[] // Ãœretim sÃ¼reÃ§ takibi
  productionTracking ProductionTracking[]
  revisions          Revision[]
  messages           Message[] // SipariÅŸ bazlÄ± mesajlaÅŸma

  // Company relation
  company   Company? @relation(fields: [companyId], references: [id])
  companyId Int?

  // Tasks
  tasks Task[] @relation("OrderTasks")

  // Notifications
  notifications Notification[] @relation("OrderNotifications")

  // ========================================
  // PERFORMANCE INDEXES
  // ========================================
  @@index([status]) // Status filtering
  @@index([customerId, status]) // Customer orders by status
  @@index([manufactureId, status]) // Manufacturer orders by status
  @@index([companyId, status, createdAt]) // Company orders with sorting
  @@index([collectionId]) // Collection relation
  @@index([orderNumber]) // Unique lookup
  @@index([createdAt]) // Date sorting
  @@index([status, createdAt]) // Status + date combination
  @@index([estimatedProductionDate]) // Production date filter
  @@index([shippingDate]) // Shipping date filter
  @@map("orders")
}

// SipariÅŸ Ã¼retim geÃ§miÅŸi takibi
model OrderProduction {
  id            Int         @id @default(autoincrement())
  createdAt     DateTime    @default(now())
  status        OrderStatus
  note          String? // Ãœretici aÃ§Ä±klamasÄ±
  estimatedDays Int? // Bu aÅŸama iÃ§in tahmini gÃ¼n
  actualDate    DateTime? // Bu aÅŸamanÄ±n gerÃ§ek tamamlanma tarihi
  order         Order       @relation(fields: [orderId], references: [id])
  orderId       Int
  updatedBy     User        @relation("OrderProductionUpdates", fields: [updatedById], references: [id])
  updatedById   Int
}

// Soru-cevap sistemi
model Question {
  id            Int        @id @default(autoincrement())
  createdAt     DateTime   @default(now())
  updatedAt     DateTime   @updatedAt
  question      String
  answer        String?
  isAnswered    Boolean    @default(false)
  isPublic      Boolean    @default(true) // Herkese gÃ¶rÃ¼nÃ¼r mÃ¼?
  collection    Collection @relation(fields: [collectionId], references: [id])
  collectionId  Int
  customer      User       @relation("CustomerQuestions", fields: [customerId], references: [id])
  customerId    Int
  manufacture   User       @relation("ManufactureQuestions", fields: [manufactureId], references: [id])
  manufactureId Int
}

// DeÄŸerlendirme sistemi
model Review {
  id           Int        @id @default(autoincrement())
  createdAt    DateTime   @default(now())
  updatedAt    DateTime   @updatedAt
  rating       Int // 1-5 yÄ±ldÄ±z
  comment      String?
  isApproved   Boolean    @default(false) // Ãœretici onayÄ±
  collection   Collection @relation(fields: [collectionId], references: [id])
  collectionId Int
  customer     User       @relation("CustomerReviews", fields: [customerId], references: [id])
  customerId   Int
}

// Enum'lar
enum SampleType {
  STANDARD // Mevcut Ã¼rÃ¼n iÃ§in standart numune
  REVISION // Mevcut Ã¼rÃ¼n iÃ§in revize istekli numune
  CUSTOM // MÃ¼ÅŸteri kendi tasarÄ±mÄ± iÃ§in numune
  DEVELOPMENT // Mevcut veriler iÃ§in backward compatibility
}

enum SampleStatus {
  // === Ä°LK AÅžAMALAR (AI ve Talep) ===
  AI_DESIGN // AI ile oluÅŸturulmuÅŸ tasarÄ±m (henÃ¼z Ã¼reticiye gÃ¶nderilmedi)
  PENDING_APPROVAL // Ãœretici onayÄ± bekleniyor (eski flow iÃ§in)
  PENDING // Beklemede - Yeni talep

  // === Ä°NCELEME ve TEKLÄ°F AÅžAMASI ===
  REVIEWED // Ãœretici tarafÄ±ndan inceleniyor
  QUOTE_SENT // Ãœretici sÃ¼re ve fiyat teklifi gÃ¶nderdi
  CUSTOMER_QUOTE_SENT // MÃ¼ÅŸteri teklif gÃ¶nderdi (standart veya revize)
  MANUFACTURER_REVIEWING_QUOTE // Ãœretici mÃ¼ÅŸteri teklifini inceliyor

  // === ONAY/RED DURUMLAR ===
  CONFIRMED // MÃ¼ÅŸteri onayladÄ±, Ã¼retim baÅŸlayabilir
  REJECTED // Genel red
  REJECTED_BY_CUSTOMER // MÃ¼ÅŸteri tarafÄ±ndan reddedildi
  REJECTED_BY_MANUFACTURER // Ãœretici tarafÄ±ndan reddedildi

  // === ÃœRETÄ°M AÅžAMALARI ===
  IN_DESIGN // TasarÄ±m aÅŸamasÄ±nda (eski flow)
  PATTERN_READY // KalÄ±p hazÄ±r (eski flow)
  IN_PRODUCTION // Ãœretim aÅŸamasÄ±nda
  PRODUCTION_COMPLETE // Ãœretim tamamlandÄ±

  // === KALÄ°TE ve TESLÄ°MAT ===
  QUALITY_CHECK // Kalite kontrolde
  SHIPPED // Kargoya verildi
  DELIVERED // MÃ¼ÅŸteriye teslim edildi

  // === DÄ°ÄžER DURUMLAR ===
  ON_HOLD // Durduruldu (geÃ§ici olarak askÄ±ya alÄ±ndÄ±)
  CANCELLED // Ä°ptal edildi

  // === ESKÄ° FLOW Ä°Ã‡Ä°N (Geriye dÃ¶nÃ¼k uyumluluk) ===
  REQUESTED // MÃ¼ÅŸteri tarafÄ±ndan talep edildi (eski)
  RECEIVED // Ãœretici talebi aldÄ± (eski)
  COMPLETED // TamamlandÄ± (eski - artÄ±k DELIVERED kullanÄ±lÄ±yor)
}

enum OrderStatus {
  PENDING // SipariÅŸ beklemede
  REVIEWED // Ãœretici tarafÄ±ndan inceleniyor
  QUOTE_SENT // Ãœretici sÃ¼re ve fiyat teklifi gÃ¶nderdi
  CUSTOMER_QUOTE_SENT // MÃ¼ÅŸteri teklif gÃ¶nderdi (standart veya revize)
  MANUFACTURER_REVIEWING_QUOTE // Ãœretici mÃ¼ÅŸteri teklifini inceliyor
  CONFIRMED // MÃ¼ÅŸteri sipariÅŸi onayladÄ±
  REJECTED // SipariÅŸ reddedildi
  REJECTED_BY_CUSTOMER // MÃ¼ÅŸteri tarafÄ±ndan reddedildi
  REJECTED_BY_MANUFACTURER // Ãœretici tarafÄ±ndan reddedildi
  IN_PRODUCTION // Ãœretim aÅŸamasÄ±nda
  PRODUCTION_COMPLETE // Ãœretim tamamlandÄ±
  QUALITY_CHECK // Kalite kontrolÃ¼ yapÄ±lÄ±yor
  SHIPPED // Kargoya verildi
  DELIVERED // MÃ¼ÅŸteriye teslim edildi
  CANCELLED // Ä°ptal edildi
}

model File {
  id          String   @id @default(cuid())
  filename    String
  path        String
  size        Int
  mimetype    String
  encoding    String?
  description String?
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt

  @@map("files")
}

// Production Stage Updates
model ProductionStageUpdate {
  id           Int                @id @default(autoincrement())
  production   ProductionTracking @relation(fields: [productionId], references: [id], onDelete: Cascade)
  productionId Int

  stage           ProductionStage
  status          StageStatus     @default(NOT_STARTED)
  actualStartDate DateTime?
  actualEndDate   DateTime?
  estimatedDays   Int?
  notes           String?         @db.Text
  photos          String?         @db.Text // JSON array
  isRevision      Boolean         @default(false)
  delayReason     String?         @db.Text // Gecikme sebebi
  extraDays       Int             @default(0)

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@map("production_stage_updates")
}

// Quality Control
model QualityControl {
  id           Int                @id @default(autoincrement())
  production   ProductionTracking @relation(fields: [productionId], references: [id], onDelete: Cascade)
  productionId Int
  inspector    User               @relation("QualityInspector", fields: [inspectorId], references: [id])
  inspectorId  Int

  checkDate DateTime      @default(now())
  result    QualityResult @default(PENDING)
  score     Int? // 1-100 puan
  notes     String?       @db.Text
  photos    String?       @db.Text // JSON: defect photos

  // Hata kategorileri
  fabricDefects    Boolean @default(false)
  sewingDefects    Boolean @default(false)
  measureDefects   Boolean @default(false)
  finishingDefects Boolean @default(false)

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@map("quality_controls")
}

// Workshop
model Workshop {
  id       Int          @id @default(autoincrement())
  name     String       @unique
  type     WorkshopType
  capacity Int? // GÃ¼nlÃ¼k kapasite
  location String?
  isActive Boolean      @default(true)

  owner   User @relation("WorkshopOwner", fields: [ownerId], references: [id])
  ownerId Int

  sewingProductions    ProductionTracking[] @relation("SewingWorkshop")
  packagingProductions ProductionTracking[] @relation("PackagingWorkshop")

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@map("workshops")
}

// ========================================
// LIBRARY MANAGEMENT MODELS
// ========================================

// Renk KÃ¼tÃ¼phanesi - Ãœretici standart renk paletini yÃ¶netir
model Color {
  id       Int     @id @default(autoincrement())
  name     String // "Beyaz", "Lacivert", "Gri Melanj"
  code     String? // Pantone, HEX, RAL kodu: "PANTONE 18-3838", "#FF5733"
  hexCode  String? // Web iÃ§in: "#FFFFFF"
  imageUrl String? // Renk Ã¶rneÄŸi gÃ¶rseli
  isActive Boolean @default(true)

  company   Company @relation(fields: [companyId], references: [id], onDelete: Cascade)
  companyId Int

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@unique([companyId, name]) // Bir firma iÃ§inde renk adÄ± unique
  @@map("colors")
}

// KumaÅŸ KÃ¼tÃ¼phanesi - Ãœretici mevcut kumaÅŸlarÄ±nÄ± yÃ¶netir
model Fabric {
  id          Int     @id @default(autoincrement())
  name        String // "Premium Cotton", "Stretch Denim"
  code        String? // Ä°Ã§ referans kodu: "FAB-001"
  composition String // "%100 Pamuk", "80% Cotton 20% Polyester"
  weight      Int? // Gram/m2: 180, 220, etc.
  width       Int? // cm: 150, 180
  supplier    String? // TedarikÃ§i firma adÄ±
  price       Float? // Metre fiyatÄ±
  minOrder    Int? // Minimum sipariÅŸ miktarÄ± (metre)
  leadTime    Int? // Tedarik sÃ¼resi (gÃ¼n)
  imageUrl    String? // KumaÅŸ dokusu gÃ¶rseli
  description String? @db.Text
  isActive    Boolean @default(true)

  company   Company @relation(fields: [companyId], references: [id], onDelete: Cascade)
  companyId Int

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@unique([companyId, code]) // Firma iÃ§inde kod unique (opsiyonel)
  @@map("fabrics")
}

// Beden Grubu - Standart beden setleri
model SizeGroup {
  id          Int     @id @default(autoincrement())
  name        String // "Erkek Standart", "KadÄ±n Plus Size", "Ã‡ocuk 0-2 YaÅŸ"
  category    String? // "MEN", "WOMEN", "KIDS"
  sizes       String // JSON array: ["XS", "S", "M", "L", "XL"] veya ["2", "4", "6", "8"]
  description String?
  isActive    Boolean @default(true)

  company   Company @relation(fields: [companyId], references: [id], onDelete: Cascade)
  companyId Int

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@unique([companyId, name])
  @@map("size_groups")
}

// Season Management (Library Item)
model SeasonItem {
  id          Int       @id @default(autoincrement())
  name        String // "SS25", "FW25", "SS26"
  fullName    String // "Spring/Summer 2025"
  year        Int // 2025, 2026
  type        String // "SS" (Spring/Summer) veya "FW" (Fall/Winter)
  startDate   DateTime? // Sezon baÅŸlangÄ±Ã§ tarihi
  endDate     DateTime? // Sezon bitiÅŸ tarihi
  description String?
  isActive    Boolean   @default(true)

  company   Company @relation(fields: [companyId], references: [id], onDelete: Cascade)
  companyId Int

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@unique([companyId, name])
  @@map("seasons")
}

// Fit Management (Library Item)
model FitItem {
  id          Int     @id @default(autoincrement())
  name        String // "Slim Fit", "Regular Fit", "Oversized"
  code        String? // "FIT-SLIM", "FIT-REG"
  category    String? // "UPPER" (Ã¼st giyim), "LOWER" (alt giyim), "OUTERWEAR" (dÄ±ÅŸ giyim)
  description String? @db.Text // DetaylÄ± aÃ§Ä±klama
  isActive    Boolean @default(true)

  company   Company @relation(fields: [companyId], references: [id], onDelete: Cascade)
  companyId Int

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@unique([companyId, name])
  @@map("fits")
}

// Sertifika yÃ¶netimi (GOTS, OEKO-TEX, BSCI, GRS, vb.)
model Certification {
  id        Int      @id @default(autoincrement())
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  name     String // "GOTS", "OEKO-TEX Standard 100"
  code     String? // "GOTS-2023", "OEKO-100"
  category CertificationCategory // FIBER, CHEMICAL, SOCIAL, ENVIRONMENTAL, TRACEABILITY

  // Detaylar
  issuer            String? // "GOTS International" gibi veren kuruluÅŸ
  validFrom         DateTime? // GeÃ§erlilik baÅŸlangÄ±cÄ±
  validUntil        DateTime? // Son kullanma tarihi
  certificateNumber String? // Sertifika numarasÄ±
  certificateFile   String? // PDF dosya yolu
  description       String?   @db.Text
  isActive          Boolean   @default(true)

  // Ä°liÅŸkiler
  company     Company      @relation(fields: [companyId], references: [id], onDelete: Cascade)
  companyId   Int
  collections Collection[] @relation("CollectionCertifications")

  @@index([companyId])
  @@index([category])
  @@index([isActive])
  @@map("certifications")
}

enum CertificationCategory {
  FIBER // Lif/Hammadde: GOTS, OCS, RCS, GRS, BCI
  CHEMICAL // Ãœretim/Kimyasal: OEKO-TEX, bluesign, ZDHC
  SOCIAL // Sosyal/Etik: BSCI, SA8000, WRAP
  ENVIRONMENTAL // Ã‡evresel: LCA, ISO 14067, Carbon Footprint
  TRACEABILITY // Ä°zlenebilirlik: DPP, Blockchain, QR
}

// ========================================

// Production Revisions
model ProductionRevision {
  id           Int                @id @default(autoincrement())
  production   ProductionTracking @relation(fields: [productionId], references: [id], onDelete: Cascade)
  productionId Int

  reason      String
  description String? @db.Text
  extraDays   Int     @default(0)
  extraCost   Float   @default(0)
  isApproved  Boolean @default(false)

  requestedBy   User @relation("RevisionRequester", fields: [requestedById], references: [id])
  requestedById Int

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@map("production_revisions")
}

// Production Enums
enum ProductionStage {
  PLANNING
  FABRIC
  CUTTING
  SEWING
  QUALITY
  PACKAGING
  SHIPPING
}

enum StageStatus {
  NOT_STARTED
  IN_PROGRESS
  ON_HOLD
  COMPLETED
  REQUIRES_REVISION
}

enum ProductionStatus {
  IN_PROGRESS
  WAITING
  BLOCKED
  COMPLETED
  CANCELLED
}

enum QualityResult {
  PENDING
  PASSED
  FAILED
  CONDITIONAL_PASS
}

enum WorkshopType {
  SEWING
  PACKAGING
  QUALITY_CONTROL
  GENERAL
}

// ========================================
// NOTIFICATION SYSTEM
// ========================================

enum NotificationType {
  ORDER // SipariÅŸ bildirimleri
  SAMPLE // Numune bildirimleri
  MESSAGE // Mesaj bildirimleri
  PRODUCTION // Ãœretim bildirimleri
  QUALITY // Kalite kontrol bildirimleri
  SYSTEM // Sistem bildirimleri
}

model Notification {
  id      Int              @id @default(autoincrement())
  type    NotificationType
  title   String
  message String           @db.Text
  link    String? // Ä°lgili sayfanÄ±n URL'i
  isRead  Boolean          @default(false)

  // Ä°liÅŸkiler
  userId Int
  user   User @relation("UserNotifications", fields: [userId], references: [id], onDelete: Cascade)

  // Ä°lgili kayÄ±tlar (opsiyonel)
  orderId              Int?
  order                Order?              @relation("OrderNotifications", fields: [orderId], references: [id], onDelete: Cascade)
  sampleId             Int?
  sample               Sample?             @relation("SampleNotifications", fields: [sampleId], references: [id], onDelete: Cascade)
  productionTrackingId Int?
  productionTracking   ProductionTracking? @relation("ProductionNotifications", fields: [productionTrackingId], references: [id], onDelete: Cascade)

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  // ========================================
  // PERFORMANCE INDEXES
  // ========================================
  @@index([userId, isRead]) // User unread notifications
  @@index([userId, createdAt]) // User notifications with sorting
  @@index([userId, type]) // User notifications by type
  @@index([type, isRead]) // Type + read status
  @@index([orderId]) // Order notifications
  @@index([sampleId]) // Sample notifications
  @@index([productionTrackingId]) // Production notifications
  @@map("notifications")
}

// ========================================
// Task Model - MÃ¼ÅŸteri/KullanÄ±cÄ± AksiyonlarÄ±
// ========================================

enum TaskStatus {
  TODO // YapÄ±lmasÄ± gerekenler
  IN_PROGRESS // Devam ediyor
  COMPLETED // TamamlandÄ±
  CANCELLED // Ä°ptal edildi
}

enum TaskPriority {
  LOW // DÃ¼ÅŸÃ¼k Ã¶ncelik
  MEDIUM // Orta Ã¶ncelik
  HIGH // YÃ¼ksek Ã¶ncelik
}

enum TaskType {
  // === STATUS BAZLI GÃ–REVLER (Dinamik) ===
  STATUS_CHANGE // Status deÄŸiÅŸikliÄŸi gerektiren gÃ¶rev (SampleStatus, OrderStatus ile iliÅŸkili)

  // === Ã–ZEL GÃ–REV TÄ°PLERÄ° ===
  QUOTATION // Fiyat teklifi hazÄ±rla/gÃ¶nder
  REVIEW_QUOTE // Teklifi incele (mÃ¼ÅŸteri veya Ã¼retici)
  APPROVE_REJECT // Onay/Red aksiyonu gerekli
  PAYMENT // Ã–deme iÅŸlemi
  DOCUMENT // Belge/DokÃ¼man iÅŸlemi

  // === ÃœRETÄ°M SÃœRECÄ° GÃ–REVLER ===
  PRODUCTION_STAGE // Ãœretim aÅŸama gÃ¶revleri (ProductionStage ile iliÅŸkili)
  QUALITY_CHECK // Kalite kontrol gÃ¶revi
  SHIPMENT // Kargo/Sevkiyat iÅŸlemi
  MATERIAL // Malzeme tedarik/kontrol

  // === GENEL GÃ–REVLER ===
  MEETING // ToplantÄ±
  REVISION // Revize talebi
  NOTIFICATION // Bilgilendirme (aksiyon gerektirmeyen)
  DEADLINE_WARNING // Termin uyarÄ±sÄ±
  OTHER // DiÄŸer
}

model Task {
  id          Int          @id @default(autoincrement())
  title       String // GÃ¶rev baÅŸlÄ±ÄŸÄ± (Ã¶rn: "Teklif OnayÄ± Bekliyor")
  description String?      @db.LongText // DetaylÄ± aÃ§Ä±klama
  status      TaskStatus   @default(TODO)
  priority    TaskPriority @default(MEDIUM)
  type        TaskType

  // STATUS Ä°LÄ°ÅžKÄ°SÄ° - Hangi status iÃ§in bu task oluÅŸturuldu
  relatedStatus String? // "QUOTE_SENT", "CUSTOMER_QUOTE_SENT", vb.
  targetStatus  String? // Hedef status (bu task tamamlandÄ±ÄŸÄ±nda gidilecek status)
  entityType    String? // "ORDER", "SAMPLE", "PRODUCTION" - Hangi entity iÃ§in

  // ÃœRETÄ°M AÅžAMASI Ä°LÄ°ÅžKÄ°SÄ°
  productionStage String? // "PLANNING", "FABRIC", "CUTTING", vb. (ProductionStage enum deÄŸeri)

  // KullanÄ±cÄ± ve Ä°liÅŸkilendirmeler
  userId Int // GÃ¶revin oluÅŸturduÄŸu kullanÄ±cÄ± (mÃ¼ÅŸteri veya Ã¼retici)
  user   User @relation("UserTasks", fields: [userId], references: [id], onDelete: Cascade)

  // GÃ¶zlemci (Ãœretici taraf iÃ§in gelen gÃ¶revlerde atanan kiÅŸi)
  assignedToId Int? // Kime atanÄ±yor (null ise kendisine atanmÄ±ÅŸ)
  assignedTo   User? @relation("AssignedTasks", fields: [assignedToId], references: [id], onDelete: SetNull)

  // Opsiyonel Ä°liÅŸkiler
  collectionId Int? // Koleksiyonla ilgili gÃ¶rev
  collection   Collection? @relation("CollectionTasks", fields: [collectionId], references: [id], onDelete: SetNull)

  sampleId Int? // Ã–rnek talebesiyle ilgili gÃ¶rev
  sample   Sample? @relation("SampleTasks", fields: [sampleId], references: [id], onDelete: SetNull)

  orderId Int? // SipariÅŸ talebesiyle ilgili gÃ¶rev
  order   Order? @relation("OrderTasks", fields: [orderId], references: [id], onDelete: SetNull)

  productionTrackingId Int?
  productionTracking   ProductionTracking? @relation("ProductionTrackingTasks", fields: [productionTrackingId], references: [id], onDelete: SetNull)

  // Tarihler
  dueDate     DateTime? // Son teslim tarihi
  completedAt DateTime? // Tamamlanma tarihi
  createdAt   DateTime  @default(now())
  updatedAt   DateTime  @updatedAt

  // Metadata
  notes      String? @db.LongText // Notlar
  assignedBy Int? // Kimin tarafÄ±ndan atandÄ±ÄŸÄ±

  // Aksiyon Metadata (JSON)
  actionData Json? // Aksiyonla ilgili ekstra data: {buttonText, endpoint, requiredFields, etc.}

  // ========================================
  // PERFORMANCE INDEXES
  // ========================================
  @@index([userId, status]) // User tasks by status
  @@index([assignedToId, status]) // Assigned tasks by status
  @@index([userId, dueDate]) // User tasks by due date
  @@index([status, priority]) // Status + priority filter
  @@index([dueDate]) // Due date sorting
  @@index([relatedStatus]) // Status bazlÄ± filtreleme iÃ§in
  @@index([entityType, relatedStatus]) // Entity ve status kombinasyonu
  @@index([type, status]) // Task type + status
  @@index([createdAt]) // Date sorting
  @@index([productionStage]) // Production stage filter
  @@index([userId, completedAt]) // User completed tasks
  @@map("tasks")
}

// ========================================
