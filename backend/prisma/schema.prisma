// This is your Prisma schema file,
// learn more about it in the docs: https://pris.ly/d/prisma-schema

generator client {
  provider      = "prisma-client-js"
  output        = "../lib/generated"
  binaryTargets = ["native", "darwin-arm64", "windows"]
}
generator pothos {
  provider = "prisma-pothos-types"
  clientOutput = "./generated" // relative path from pothos output to prisma client
  output = "../lib/pothos-prisma-types.ts"
}

datasource db {
  provider = "mysql"
  url      = env("DATABASE_URL")
}

enum Role {
  ADMIN // Platform admin
  COMPANY_OWNER // Firma sahibi (hem Ã¼retici hem mÃ¼ÅŸteri)
  COMPANY_EMPLOYEE // Firma Ã§alÄ±ÅŸanÄ± (hem Ã¼retici hem mÃ¼ÅŸteri)
  INDIVIDUAL_CUSTOMER // Bireysel mÃ¼ÅŸteri (firma olmadan)

  // Backward compatibility (deprecated)
  MANUFACTURE
  CUSTOMER
}

enum CompanyType {
  MANUFACTURER // Ãœretici firma (Defacto)
  BUYER // AlÄ±cÄ± firma (LC Waikiki)
  BOTH // Her ikisi de (hem Ã¼retir hem alÄ±r)
}

// Department Enum - COMPANY_EMPLOYEE rolleri iÃ§in
enum Department {
  PURCHASING   // SatÄ±n Alma
  PRODUCTION   // Ãœretim
  QUALITY      // Kalite Kontrol
  DESIGN       // TasarÄ±m
  SALES        // SatÄ±ÅŸ
  MANAGEMENT   // YÃ¶netim
}

// Subscription Plan Enum
enum SubscriptionPlan {
  FREE          // Ãœcretsiz plan (trial)
  STARTER       // BaÅŸlangÄ±Ã§ planÄ±
  PROFESSIONAL  // Profesyonel plan
  ENTERPRISE    // Kurumsal plan
  CUSTOM        // Ã–zel anlaÅŸma
}

// Subscription Status Enum
enum SubscriptionStatus {
  TRIAL       // Deneme sÃ¼resi
  ACTIVE      // Aktif abonelik
  PAST_DUE    // Ã–deme gecikmiÅŸ
  CANCELLED   // Ä°ptal edilmiÅŸ
  EXPIRED     // SÃ¼resi dolmuÅŸ
}

// Billing Cycle Enum
enum BillingCycle {
  MONTHLY  // AylÄ±k
  YEARLY   // YÄ±llÄ±k
}

// Tekstil Enums
enum Season {
  SS25 // Spring/Summer 2025
  FW25 // Fall/Winter 2025
  SS26 // Spring/Summer 2026
  FW26 // Fall/Winter 2026
  SS27
  FW27
}

enum Gender {
  WOMEN // KadÄ±n
  MEN // Erkek
  GIRLS // KÄ±z Ã‡ocuk
  BOYS // Erkek Ã‡ocuk
  UNISEX // Unisex
}

enum Fit {
  REGULAR // Regular
  SLIM // Slim
  RELAXED // Relaxed
  OVERSIZED // Oversized
  FITTED // Fitted
  LOOSE // Loose
}

model Company {
  id          Int         @id @default(autoincrement())
  name        String
  email       String?     @unique
  phone       String?
  address     String?
  city        String? // Åžehir: "Ä°stanbul", "Ä°zmir", "Denizli"
  country     String? // Ãœlke: "Turkey", "Germany", etc.
  location    String? // Deprecated - use city instead
  website     String?
  type        CompanyType @default(MANUFACTURER)
  description String?     @db.Text

  // Owner
  owner   User? @relation("CompanyOwner", fields: [ownerId], references: [id])
  ownerId Int?  @unique

  isActive Boolean @default(true)
  settings Json? // Company-wide settings

  // ========================================
  // SUBSCRIPTION SYSTEM
  // ========================================
  subscriptionPlan   SubscriptionPlan   @default(FREE)
  subscriptionStatus SubscriptionStatus @default(TRIAL)

  // Trial Period
  trialStartedAt DateTime? @default(now())
  trialEndsAt    DateTime? // 14 gÃ¼n trial

  // Subscription Billing
  subscriptionStartedAt DateTime? // Ãœcretli abonelik baÅŸlangÄ±cÄ±
  currentPeriodStart    DateTime? // Mevcut dÃ¶nem baÅŸlangÄ±cÄ±
  currentPeriodEnd      DateTime? // Mevcut dÃ¶nem bitiÅŸi
  cancelAtPeriodEnd     Boolean   @default(false)
  cancelledAt           DateTime? // Ä°ptal tarihi
  billingCycle          BillingCycle @default(MONTHLY)
  billingEmail          String? // Fatura e-postasÄ±
  billingAddress        String? @db.Text
  taxId                 String? // Vergi numarasÄ±

  // Usage Limits (Plan-based)
  maxUsers        Int   @default(3) // FREE: 3, STARTER: 10, PRO: 50, ENT: unlimited
  maxSamples      Int   @default(10) // FREE: 10, STARTER: 100, PRO: 500, ENT: unlimited
  maxOrders       Int   @default(5) // FREE: 5, STARTER: 50, PRO: 200, ENT: unlimited
  maxCollections  Int   @default(5) // FREE: 5, STARTER: 20, PRO: 100, ENT: unlimited
  maxStorageGB    Float @default(1.0) // FREE: 1GB, STARTER: 10GB, PRO: 100GB, ENT: unlimited

  // Current Usage (auto-calculated)
  currentUsers        Int   @default(0)
  currentSamples      Int   @default(0)
  currentOrders       Int   @default(0)
  currentCollections  Int   @default(0)
  currentStorageGB    Float @default(0.0)

  // ========================================
  // BRANDING & CUSTOMIZATION
  // ========================================
  logo        String? // Logo URL
  coverImage  String? // Kapak gÃ¶rseli URL
  brandColors Json? // { primary: "#xxx", secondary: "#xxx", accent: "#xxx" }

  // Public Profile (for manufacturers to showcase)
  profileSlug     String?  @unique // URL-friendly slug: "defacto", "koton"
  isPublicProfile Boolean  @default(false) // Herkese aÃ§Ä±k profil mi?
  socialLinks     Json? // { instagram: "...", linkedin: "...", website: "..." }

  // Dashboard Preferences
  defaultView    String? // "MANUFACTURER" | "BUYER" (for BOTH type companies)
  enabledModules Json? // { samples: true, orders: true, production: true, etc. }

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  // Relations
  employees          User[]               @relation("CompanyEmployees")
  categories         Category[]
  companyCategories  CompanyCategory[]    // Yeni standart kategori sistemi
  collections        Collection[]
  samples            Sample[]
  orders             Order[]
  productionTracking ProductionTracking[]
  messages           Message[]

  // Library Management (Unified)
  libraryItems   LibraryItem[] @relation("CompanyLibraryItems")

  // Company Partnerships & Collaboration
  partnershipsAsInitiator  CompanyPartnership[] @relation("CompanyAsInitiator")
  partnershipsAsPartner    CompanyPartnership[] @relation("CompanyAsPartner")
  sourceCategoryMappings   SharedCategoryMapping[] @relation("SourceCategoryCompany")
  targetCategoryMappings   SharedCategoryMapping[] @relation("TargetCategoryCompany")

  // Analytics
  metrics         CompanyMetrics[]

  @@index([email])
  @@index([type, isActive])
  @@index([isActive, createdAt])
  @@index([location])
  @@index([ownerId])
  @@index([subscriptionPlan])
  @@index([subscriptionStatus])
  @@index([trialEndsAt])
  @@index([currentPeriodEnd])
  @@index([profileSlug])
  @@index([isPublicProfile])
  @@fulltext([name, description])
  @@map("companies")
}

model Message {
  id        Int      @id @default(autoincrement())
  content   String   @db.Text
  senderId  Int
  receiverId Int?    // AlÄ±cÄ± kullanÄ±cÄ± ID
  isRead    Boolean  @default(false)
  type      String   @default("general") // "order", "sample", "general"

  // ÃœrÃ¼n bazlÄ± mesajlaÅŸma
  orderId   Int?
  sampleId  Int?

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  // Relations
  sender    User     @relation("SentMessages", fields: [senderId], references: [id], onDelete: Cascade)
  receiver  User?    @relation("ReceivedMessages", fields: [receiverId], references: [id], onDelete: Cascade)
  order     Order?   @relation(fields: [orderId], references: [id], onDelete: Cascade)
  sample    Sample?  @relation(fields: [sampleId], references: [id], onDelete: Cascade)
  company   Company? @relation(fields: [companyId], references: [id])
  companyId Int?

  @@index([orderId])
  @@index([sampleId])
  @@index([senderId])
  @@index([receiverId])
  @@map("messages")
}

model ProductionTracking {
  id       Int  @id @default(autoincrement())
  orderId  Int?
  sampleId Int?

  currentStage  ProductionStage  @default(PLANNING)
  overallStatus ProductionStatus @default(IN_PROGRESS)
  progress      Int              @default(0) // 0-100%

  estimatedStartDate DateTime?
  estimatedEndDate   DateTime?
  actualStartDate    DateTime?
  actualEndDate      DateTime?

  notes String? @db.Text

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  // Relations
  order     Order?   @relation(fields: [orderId], references: [id])
  sample    Sample?  @relation(fields: [sampleId], references: [id])
  company   Company? @relation(fields: [companyId], references: [id])
  companyId Int?

  // New relations
  sewingWorkshop      Workshop? @relation("SewingWorkshop", fields: [sewingWorkshopId], references: [id])
  sewingWorkshopId    Int?
  packagingWorkshop   Workshop? @relation("PackagingWorkshop", fields: [packagingWorkshopId], references: [id])
  packagingWorkshopId Int?

  stageUpdates        ProductionStageUpdate[]
  qualityControls     QualityControl[]
  productionRevisions ProductionRevision[]
  revisions           Revision[] // Legacy
  tasks               Task[] @relation("ProductionTrackingTasks")
  notifications       Notification[] @relation("ProductionNotifications")

  @@map("production_tracking")
}

model Revision {
  id                   Int       @id @default(autoincrement())
  orderId              Int?
  sampleId             Int?
  productionTrackingId Int?
  revisionNumber       Int       @default(1)
  requestMessage       String?
  responseMessage      String?
  status               String    @default("pending")
  requestedAt          DateTime  @default(now())
  completedAt          DateTime?
  createdAt            DateTime  @default(now())
  updatedAt            DateTime  @updatedAt

  // Relations
  order              Order?              @relation(fields: [orderId], references: [id])
  sample             Sample?             @relation(fields: [sampleId], references: [id])
  productionTracking ProductionTracking? @relation(fields: [productionTrackingId], references: [id])

  @@map("revisions")
}

model User {
  id        Int     @id @default(autoincrement())
  email     String  @unique
  password  String
  name      String?
  username  String? @unique
  firstName String?
  lastName  String?
  phone     String?

  // Company & Role
  company   Company? @relation("CompanyEmployees", fields: [companyId], references: [id])
  companyId Int?
  role      Role     @default(INDIVIDUAL_CUSTOMER)

  // Company Ownership & Permissions
  isCompanyOwner Boolean     @default(false)
  department     Department? // Enum: PURCHASING, PRODUCTION, QUALITY, DESIGN, SALES, MANAGEMENT
  jobTitle       String? // "MÃ¼dÃ¼r", "Uzman", "KoordinatÃ¶r"
  permissions    Json? // DetaylÄ± permission objesi

  // Status
  isActive          Boolean @default(true)
  isPendingApproval Boolean @default(false)

  // ========================================
  // USER PROFILE & SETTINGS
  // ========================================
  avatar       String? @db.Text // Profile picture URL from OAuth providers (GitHub/Google)
  customAvatar String? @db.Text // User's custom uploaded profile picture (overrides avatar)
  bio          String? @db.Text // User bio/description
  socialLinks  Json? // { twitter: "...", linkedin: "...", github: "..." }

  // Notification Settings
  emailNotifications Boolean @default(true)
  pushNotifications  Boolean @default(false)

  // Localization
  language String @default("tr") // "tr", "en"
  timezone String @default("Europe/Istanbul")

  // Password Reset
  resetToken       String?   // Token for password reset
  resetTokenExpiry DateTime? // Token expiration date

  // Email Verification
  emailVerified           Boolean   @default(false) // Email doÄŸrulandÄ± mÄ±?
  emailVerificationToken  String?   // Email doÄŸrulama token
  emailVerificationExpiry DateTime? // Token son kullanma tarihi

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  // Owned Companies
  ownedCompanies Company[] @relation("CompanyOwner")

  // Messages relation
  sentMessages     Message[] @relation("SentMessages")
  receivedMessages Message[] @relation("ReceivedMessages")

  // Category Management
  categories                Category[]
  createdStandardCategories StandardCategory[] @relation("StandardCategoryCreator")
  createdCompanyCategories  CompanyCategory[]

  collections      Collection[]

  // Customer relations
  customerSamples   Sample[]   @relation("CustomerSamples")
  customerOrders    Order[]    @relation("CustomerOrders")
  customerQuestions Question[] @relation("CustomerQuestions")
  customerReviews   Review[]   @relation("CustomerReviews")

  // Manufacture relations
  manufactureSamples      Sample[]           @relation("ManufactureSamples")
  manufactureOrders       Order[]            @relation("ManufactureOrders")
  manufactureQuestions    Question[]         @relation("ManufactureQuestions")
  sampleProductionUpdates SampleProduction[]
  orderProductionUpdates  OrderProduction[]  @relation("OrderProductionUpdates")

  // Production system relations
  qualityInspections QualityControl[]     @relation("QualityInspector")
  ownedWorkshops     Workshop[]           @relation("WorkshopOwner")
  revisionRequests   ProductionRevision[] @relation("RevisionRequester")

  // Favorites/Likes
  favoriteCollections UserFavoriteCollection[]

  // Notifications
  notifications Notification[] @relation("UserNotifications")

  // Tasks
  tasks         Task[] @relation("UserTasks")
  assignedTasks Task[] @relation("AssignedTasks")

  // Company Partnerships & Category Mappings
  initiatedPartnerships     CompanyPartnership[] @relation
  approvedPartnerships      CompanyPartnership[] @relation("PartnershipApprover")
  createdCategoryMappings   SharedCategoryMapping[]

  // Admin Reports
  createdReports            AdminReport[]

  // Unified Library Management (Admin)
  createdLibraryItems       LibraryItem[] @relation("LibraryItemCreator")

  @@index([email])
  @@index([username])
  @@index([companyId, role])
  @@index([companyId, isActive])
  @@index([companyId, department])
  @@index([role, isActive])
  @@index([isActive])
  @@index([isPendingApproval])
  @@index([createdAt])
  @@map("users")
}

// ========================================
// STANDARDIZED CATEGORY SYSTEM FOR TEXTILE INDUSTRY
// ========================================

enum CategoryType {
  GLOBAL_STANDARD   // Platform geneli standart kategori (admin tanÄ±mlÄ±)
  COMPANY_CUSTOM    // Firma Ã¶zel kategorisi (kendi kullanÄ±mÄ± iÃ§in)
}

enum CategoryLevel {
  ROOT              // Ana kategori (Tekstil, Giyim, Aksesuar)
  MAIN              // Ana grup (Ãœst Giyim, Alt Giyim, Ä°Ã§ Giyim)
  SUB               // Alt grup (GÃ¶mlek, Pantolon, Elbise)
  DETAIL            // Detay (Uzun Kollu GÃ¶mlek, KÄ±sa Kollu GÃ¶mlek)
}

// Platform Geneli Standart Kategori AÄŸacÄ± (Admin yÃ¶netir)
model StandardCategory {
  id          Int           @id @default(autoincrement())
  code        String        @unique // "TEX-001", "GAR-001-001", "ACC-002"
  name        String        // i18n key or direct name (frontend handles translations)
  description      String? @db.Text // i18n key or direct description

  level            CategoryLevel
  order            Int       @default(0) // SÄ±ralama iÃ§in
  icon             String?   // Icon URL veya code
  image            String?   // Kategori gÃ¶rseli

  isActive         Boolean   @default(true)
  isPublic         Boolean   @default(true) // TÃ¼m firmalara aÃ§Ä±k mÄ±?

  // Meta bilgiler
  keywords         String?   @db.Text // Arama iÃ§in keywords (JSON array)
  tags             String?   // "#gÃ¶mlek #shirt #formal" gibi

  // Ä°liÅŸkiler
  parentCategory   StandardCategory?  @relation("StandardCategoryTree", fields: [parentId], references: [id])
  parentId         Int?
  subCategories    StandardCategory[] @relation("StandardCategoryTree")

  // Åžirketlerin bu standart kategoriyi kullanÄ±mÄ±
  companyCategories CompanyCategory[]

  // Admin
  createdBy        User?     @relation("StandardCategoryCreator", fields: [createdById], references: [id])
  createdById      Int?

  createdAt        DateTime  @default(now())
  updatedAt        DateTime  @updatedAt

  @@index([code])
  @@index([level])
  @@index([parentId])
  @@index([isActive, isPublic])
  @@index([order])
  @@fulltext([name, description, keywords])
  @@map("standard_categories")
}

// Firma BazlÄ± Kategori Sistemi (Standart kategorileri extend eder veya Ã¶zel ekler)
model CompanyCategory {
  id          Int          @id @default(autoincrement())
  type        CategoryType @default(COMPANY_CUSTOM)

  // Standart kategori referansÄ± (varsa)
  standardCategory   StandardCategory? @relation(fields: [standardCategoryId], references: [id])
  standardCategoryId Int?

  // Firma Ã¶zel bilgileri
  name        String       // Firma kendi adÄ±nÄ± verebilir: "Defacto GÃ¶mlek", "Koton T-Shirt"
  description String?      @db.Text

  // Ä°liÅŸkiler
  company     Company      @relation(fields: [companyId], references: [id], onDelete: Cascade)
  companyId   Int

  parentCategory     CompanyCategory?  @relation("CompanyCategoryTree", fields: [parentId], references: [id])
  parentId           Int?
  subCategories      CompanyCategory[] @relation("CompanyCategoryTree")

  // Firma iÃ§i Ã¶zel alanlar
  internalCode       String?  // Firma iÃ§i referans kodu
  order              Int      @default(0)
  isActive           Boolean  @default(true)

  // KullanÄ±m istatistikleri
  productCount       Int      @default(0) // Bu kategoride kaÃ§ Ã¼rÃ¼n var
  lastUsedAt         DateTime?

  // Metadata
  customFields       Json?    // Firma Ã¶zel alanlarÄ±: { targetAge: "18-25", priceRange: "mid", etc. }

  // Relations
  collections        Collection[]

  // Cross-brand category mappings
  sourceMappings     SharedCategoryMapping[] @relation("SourceCategory")
  targetMappings     SharedCategoryMapping[] @relation("TargetCategory")

  author             User?    @relation(fields: [authorId], references: [id])
  authorId           Int?

  createdAt          DateTime @default(now())
  updatedAt          DateTime @updatedAt

  @@unique([companyId, parentId, name]) // AynÄ± firma, aynÄ± parent altÄ±nda aynÄ± isim olamaz
  @@index([companyId, type])
  @@index([companyId, isActive])
  @@index([standardCategoryId])
  @@index([parentId])
  @@index([productCount])
  @@fulltext([name, description])
  @@map("company_categories")
}

// Legacy Category model (backward compatibility - will be migrated)
model Category {
  id               Int          @id @default(autoincrement())
  createdAt        DateTime     @default(now())
  updatedAt        DateTime     @updatedAt
  name             String
  description      String?
  author           User?        @relation(fields: [authorId], references: [id])
  authorId         Int?
  collections      Collection[]
  subCategories    Category[]   @relation("CategoryToSubCategories")
  parentCategory   Category?    @relation("CategoryToSubCategories", fields: [parentCategoryId], references: [id])
  parentCategoryId Int?
  company          Company?     @relation(fields: [companyId], references: [id])
  companyId        Int?

  @@unique([companyId, parentCategoryId, name])
  @@map("categories")
}

model Collection {
  id          Int      @id @default(autoincrement())
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt
  name        String
  description String?

  // ADIM 1: Temel Bilgiler
  modelCode String  @unique // THS-2024-00
  season    Season? // SS25, FW25, SS26, FW26
  // klasman -> category ile handle edilecek (GÃ¶mlek, Pantolon, Triko)
  gender    Gender? // KadÄ±n, Erkek, KÄ±z Ã‡ocuk, Erkek Ã‡ocuk
  fit       String? // Library'den seÃ§ilen fit adÄ±: "Slim Fit", "Regular Fit", "Relaxed Fit"
  trend     String? // Trend adÄ±: "Minimalist", "Vintage", "Sport Chic", "Y2K"

  // ADIM 2: Varyantlar ve Ã–lÃ§Ã¼ler
  colors           String? // JSON array: ["beyaz", "siyah", "yeÅŸil"]
  sizeGroups       String? // JSON array of group IDs: [1, 2, 3] - Birden fazla beden grubu (pantolon + gÃ¶mlek)
  sizeRange        String? // Manuel override: "S-XL" veya "6-16" (legacy)
  measurementChart String? // File path: /uploads/measurements/xxx.pdf

  // ADIM 3: Teknik Detaylar
  fabricComposition String? // "%100 Cotton" veya "80% Cotton 20% Polyester"
  accessories       String? @db.Text // JSON: {"buttons": "metal", "zipper": "YKK", "labels": "woven"}
  images            String? @db.Text // JSON array: ["/uploads/products/img1.jpg", ...] or ["https://..."]
  techPack          String? // File path: /uploads/techpacks/xxx.pdf

  // ADIM 4: Ticari Bilgiler
  moq            Int? // Minimum Order Quantity
  targetPrice    Float? // Hedef fiyat (USD)
  targetLeadTime Int? // Hedef termin (gÃ¼n)
  notes          String? @db.Text // AÃ§Ä±klama/Notlar

  // Sertifikalar (GOTS, OEKO-TEX, BSCI vb.) - ArtÄ±k LibraryItem Ã¼zerinden
  certifications LibraryItem[] @relation("CollectionCertifications")

  // BeÄŸeni/Favoriler
  likesCount  Int                      @default(0) // Toplam beÄŸeni sayÄ±sÄ±
  favoritedBy UserFavoriteCollection[] // BeÄŸenen kullanÄ±cÄ±lar

  // ========================================
  // ANALYTICS & ENGAGEMENT
  // ========================================
  viewCount    Int       @default(0) // GÃ¶rÃ¼ntÃ¼lenme sayÄ±sÄ±
  shareCount   Int       @default(0) // PaylaÅŸÄ±m sayÄ±sÄ±
  lastViewedAt DateTime? // Son gÃ¶rÃ¼ntÃ¼lenme zamanÄ±

  // Legacy fields (backward compatibility)
  price      Float   @default(0.00) // Åžimdilik targetPrice ile aynÄ±
  sku        String? @unique
  stock      Int     @default(0)
  isActive   Boolean @default(true)
  isFeatured Boolean @default(false)
  slug       String? @unique

  // Production Schedule - Her aÅŸama iÃ§in standart gÃ¼n sayÄ±sÄ±
  productionSchedule Json? // { "PLANNING": 5, "FABRIC": 3, "CUTTING": 2, "SEWING": 10, "QUALITY": 2, "PACKAGING": 2, "SHIPPING": 1 }

  category   Category? @relation(fields: [categoryId], references: [id])
  categoryId Int?

  // Yeni standart kategori sistemi (opsiyonel)
  companyCategory   CompanyCategory? @relation(fields: [companyCategoryId], references: [id])
  companyCategoryId Int?

  author     User?     @relation(fields: [authorId], references: [id]) // Ãœretici
  authorId   Int?

  // Relations
  samples        Sample[]   @relation("SampleCollection")
  revisedSamples Sample[]   @relation("OriginalCollection") // Bu Ã¼rÃ¼n iÃ§in yapÄ±lan revize numuneleri
  orders         Order[]
  questions      Question[]
  reviews        Review[]
  tasks          Task[]     @relation("CollectionTasks")

  // Company relation
  company   Company? @relation(fields: [companyId], references: [id])
  companyId Int?

  @@index([companyId, isActive])
  @@index([season])
  @@index([gender])
  @@index([isFeatured])
  @@index([isActive, createdAt])
  @@index([slug])
  @@index([modelCode])
  @@index([createdAt])
  @@index([viewCount])
  @@index([likesCount])
  @@fulltext([name, description])
  @@map("collections")
}

// User Favorite Collections (Junction Table for Likes)
model UserFavoriteCollection {
  id        Int      @id @default(autoincrement())
  createdAt DateTime @default(now())

  user   User @relation(fields: [userId], references: [id], onDelete: Cascade)
  userId Int

  collection   Collection @relation(fields: [collectionId], references: [id], onDelete: Cascade)
  collectionId Int

  @@unique([userId, collectionId])
  @@index([userId])
  @@index([collectionId])
  @@map("user_favorite_collections")
}

// Numune talep ve Ã¼retim sistemi
model Sample {
  id                   Int          @id @default(autoincrement())
  createdAt            DateTime     @default(now())
  updatedAt            DateTime     @updatedAt
  sampleNumber         String       @unique // Numune takip numarasÄ±
  sampleType           SampleType   @default(STANDARD) // Numune tipi
  status               SampleStatus @default(REQUESTED)
  customerNote         String?      @db.Text // MÃ¼ÅŸteri talep notu
  manufacturerResponse String?      @db.Text // Ãœretici yanÄ±tÄ±/deÄŸerlendirme

  // Revize/Ã–zelleÅŸtirme bilgileri (CUSTOM ve REVISION tipleri iÃ§in)
  customDesignImages   String? @db.Text // MÃ¼ÅŸteri tasarÄ±m gÃ¶rselleri (JSON)
  revisionRequests     String? // Revize istekleri (JSON: [{field, oldValue, newValue, note}])
  originalCollectionId Int? // Revize edilecek orijinal Ã¼rÃ¼n ID'si

  // AI Generated Sample fields
  name         String? // Sample name
  description  String? @db.Text // Sample description (long text)
  images       String? @db.Text // JSON array of image URLs
  aiGenerated  Boolean? @default(false) // Is this an AI-generated sample
  aiPrompt     String? @db.Text // The prompt used for AI generation
  aiSketchUrl  String? // The sketch/reference image URL used

  // Ãœretim sÃ¼reci bilgileri
  unitPrice               Float? // Numune birim fiyatÄ±
  productionDays          Int? // Ãœretici: "X gÃ¼nde Ã¼retebilirim"
  estimatedProductionDate DateTime? // Hesaplanan Ã¼retim tarihi
  actualProductionDate    DateTime? // GerÃ§ek Ã¼retim tamamlanma tarihi
  shippingDate            DateTime? // Kargoya veriliÅŸ tarihi
  deliveryAddress         String? // Teslimat adresi
  cargoTrackingNumber     String? // Kargo takip numarasÄ± (opsiyonel)

  // MÃ¼ÅŸteri Teklif Bilgileri (Order ile aynÄ±)
  customerQuotedPrice     Float? // MÃ¼ÅŸterinin teklif ettiÄŸi fiyat
  customerQuoteDays       Int? // MÃ¼ÅŸterinin istediÄŸi Ã¼retim sÃ¼resi (gÃ¼n)
  customerQuoteNote       String? @db.Text // MÃ¼ÅŸterinin teklif notu/aÃ§Ä±klamasÄ±
  customerQuoteType       String? // "STANDARD" (standartlara uygun) veya "REVISION" (revize teklif)
  customerQuoteSentAt     DateTime? // MÃ¼ÅŸteri teklifi gÃ¶nderme zamanÄ±

  collection         Collection?          @relation("SampleCollection", fields: [collectionId], references: [id])
  collectionId       Int?
  originalCollection Collection?          @relation("OriginalCollection", fields: [originalCollectionId], references: [id])
  customer           User                 @relation("CustomerSamples", fields: [customerId], references: [id])
  customerId         Int
  manufacture        User                 @relation("ManufactureSamples", fields: [manufactureId], references: [id])
  manufactureId      Int
  productionHistory  SampleProduction[] // Ãœretim geÃ§miÅŸi takibi
  productionTracking ProductionTracking[]
  revisions          Revision[]
  messages           Message[] // Numune bazlÄ± mesajlaÅŸma

  // Company relation
  company   Company? @relation(fields: [companyId], references: [id])
  companyId Int?

  // ========================================
  // ANALYTICS & ENGAGEMENT
  // ========================================
  viewCount    Int       @default(0) // GÃ¶rÃ¼ntÃ¼lenme sayÄ±sÄ±
  shareCount   Int       @default(0) // PaylaÅŸÄ±m sayÄ±sÄ±
  lastViewedAt DateTime? // Son gÃ¶rÃ¼ntÃ¼lenme zamanÄ±

  // AI Analysis relation
  aiAnalysis AIAnalysis?

  // Tasks
  tasks Task[] @relation("SampleTasks")

  // Notifications
  notifications Notification[] @relation("SampleNotifications")

  @@index([status])
  @@index([customerId, status])
  @@index([manufactureId, status])
  @@index([companyId, status, createdAt])
  @@index([collectionId])
  @@index([sampleNumber])
  @@index([sampleType, status])
  @@index([aiGenerated])
  @@index([createdAt])
  @@index([status, createdAt])
  @@index([viewCount])
  @@map("samples")
}

// AI Analiz SonuÃ§larÄ± (Numune ile iliÅŸkili)
model AIAnalysis {
  id        Int      @id @default(autoincrement())
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  // Temel Analiz SonuÃ§larÄ± (Form'a yazÄ±lan)
  detectedProduct       String? // Tespit edilen Ã¼rÃ¼n tÃ¼rÃ¼
  detectedColor         String? // Tespit edilen renk
  detectedFabric        String? // Tespit edilen kumaÅŸ
  detectedPattern       String? // Tespit edilen kalÄ±p
  detectedGender        String? // Tespit edilen cinsiyet
  detectedClassification String? // Tespit edilen klasman
  detectedAccessories   String? // Tespit edilen aksesuarlar
  technicalDescription  String? @db.Text // Teknik aÃ§Ä±klama

  // Kalite Analizi
  qualityAnalysis String? @db.Text // Kalite analiz raporu
  qualityScore    Float? // Genel kalite skoru (1-10)

  // Maliyet Analizi
  costAnalysis         String? @db.Text // Maliyet analiz raporu
  estimatedCostMin     Float? // Tahmini minimum maliyet (â‚º)
  estimatedCostMax     Float? // Tahmini maksimum maliyet (â‚º)
  suggestedMinOrder    Int? // Ã–nerilen minimum sipariÅŸ adedi

  // Trend Analizi
  trendAnalysis    String? @db.Text // Trend analiz raporu
  trendScore       Float? // Trend skoru (1-10)
  targetMarket     String? // Hedef pazar segmenti
  salesPotential   String? // SatÄ±ÅŸ potansiyeli (LOW/MEDIUM/HIGH)

  // TasarÄ±m Ã–nerileri
  designSuggestions String? @db.Text // TasarÄ±m Ã¶nerileri (JSON veya text)
  designStyle       String? // SeÃ§ilen stil yÃ¶nÃ¼
  designFocus       String? // OdaklanÄ±lan alanlar (JSON array)

  // Ä°liÅŸki
  sample   Sample @relation(fields: [sampleId], references: [id], onDelete: Cascade)
  sampleId Int    @unique

  @@map("ai_analyses")
}

// Numune Ã¼retim geÃ§miÅŸi takibi
model SampleProduction {
  id            Int          @id @default(autoincrement())
  createdAt     DateTime     @default(now())
  status        SampleStatus
  note          String? // Ãœretici aÃ§Ä±klamasÄ±
  estimatedDays Int? // Bu aÅŸama iÃ§in tahmini gÃ¼n
  actualDate    DateTime? // Bu aÅŸamanÄ±n gerÃ§ek tamamlanma tarihi
  sample        Sample       @relation(fields: [sampleId], references: [id])
  sampleId      Int
  updatedBy     User         @relation(fields: [updatedById], references: [id])
  updatedById   Int
}

// SipariÅŸ ve Ã¼retim sistemi
model Order {
  id                   Int         @id @default(autoincrement())
  createdAt            DateTime    @default(now())
  updatedAt            DateTime    @updatedAt
  orderNumber          String      @unique
  quantity             Int
  unitPrice            Float // Birim fiyat
  totalPrice           Float // Toplam fiyat
  status               OrderStatus @default(PENDING)
  customerNote         String? // MÃ¼ÅŸteri sipariÅŸ notu
  manufacturerResponse String? // Ãœretici yanÄ±tÄ±/deÄŸerlendirme

  // MÃ¼ÅŸteri Teklif Bilgileri
  customerQuotedPrice  Float? // MÃ¼ÅŸterinin teklif ettiÄŸi birim fiyat
  customerQuoteDays    Int? // MÃ¼ÅŸterinin istediÄŸi Ã¼retim sÃ¼resi (gÃ¼n)
  customerQuoteNote    String? @db.Text // MÃ¼ÅŸterinin teklif notu/aÃ§Ä±klamasÄ±
  customerQuoteType    String? // "STANDARD" (standartlara uygun) veya "REVISION" (revize teklif)
  customerQuoteSentAt  DateTime? // MÃ¼ÅŸteri teklifi gÃ¶nderme zamanÄ±

  // Ãœretim sÃ¼reci bilgileri
  productionDays          Int? // Ãœretici: "X gÃ¼nde Ã¼retebilirim"
  estimatedProductionDate DateTime? // Hesaplanan Ã¼retim tarihi
  actualProductionStart   DateTime? // GerÃ§ek Ã¼retime baÅŸlama tarihi
  actualProductionEnd     DateTime? // GerÃ§ek Ã¼retim bitiÅŸ tarihi
  shippingDate            DateTime? // Kargoya veriliÅŸ tarihi
  deliveryAddress         String? // Teslimat adresi
  cargoTrackingNumber     String? // Kargo takip numarasÄ±

  collection         Collection           @relation(fields: [collectionId], references: [id])
  collectionId       Int
  customer           User                 @relation("CustomerOrders", fields: [customerId], references: [id])
  customerId         Int
  manufacture        User                 @relation("ManufactureOrders", fields: [manufactureId], references: [id])
  manufactureId      Int
  productionHistory  OrderProduction[] // Ãœretim sÃ¼reÃ§ takibi
  productionTracking ProductionTracking[]
  revisions          Revision[]
  messages           Message[] // SipariÅŸ bazlÄ± mesajlaÅŸma

  // Company relation
  company   Company? @relation(fields: [companyId], references: [id])
  companyId Int?

  // Tasks
  tasks Task[] @relation("OrderTasks")

  // Notifications
  notifications Notification[] @relation("OrderNotifications")
}

// SipariÅŸ Ã¼retim geÃ§miÅŸi takibi
model OrderProduction {
  id            Int         @id @default(autoincrement())
  createdAt     DateTime    @default(now())
  status        OrderStatus
  note          String? // Ãœretici aÃ§Ä±klamasÄ±
  estimatedDays Int? // Bu aÅŸama iÃ§in tahmini gÃ¼n
  actualDate    DateTime? // Bu aÅŸamanÄ±n gerÃ§ek tamamlanma tarihi
  order         Order       @relation(fields: [orderId], references: [id])
  orderId       Int
  updatedBy     User        @relation("OrderProductionUpdates", fields: [updatedById], references: [id])
  updatedById   Int
}

// Soru-cevap sistemi
model Question {
  id            Int        @id @default(autoincrement())
  createdAt     DateTime   @default(now())
  updatedAt     DateTime   @updatedAt
  question      String
  answer        String?
  isAnswered    Boolean    @default(false)
  isPublic      Boolean    @default(true) // Herkese gÃ¶rÃ¼nÃ¼r mÃ¼?
  collection    Collection @relation(fields: [collectionId], references: [id])
  collectionId  Int
  customer      User       @relation("CustomerQuestions", fields: [customerId], references: [id])
  customerId    Int
  manufacture   User       @relation("ManufactureQuestions", fields: [manufactureId], references: [id])
  manufactureId Int
}

// DeÄŸerlendirme sistemi
model Review {
  id           Int        @id @default(autoincrement())
  createdAt    DateTime   @default(now())
  updatedAt    DateTime   @updatedAt
  rating       Int // 1-5 yÄ±ldÄ±z
  comment      String?
  isApproved   Boolean    @default(false) // Ãœretici onayÄ±
  collection   Collection @relation(fields: [collectionId], references: [id])
  collectionId Int
  customer     User       @relation("CustomerReviews", fields: [customerId], references: [id])
  customerId   Int
}

// Enum'lar
enum SampleType {
  STANDARD // Mevcut Ã¼rÃ¼n iÃ§in standart numune
  REVISION // Mevcut Ã¼rÃ¼n iÃ§in revize istekli numune
  CUSTOM // MÃ¼ÅŸteri kendi tasarÄ±mÄ± iÃ§in numune
  DEVELOPMENT // Mevcut veriler iÃ§in backward compatibility
}

enum SampleStatus {
  // === Ä°LK AÅžAMALAR (AI ve Talep) ===
  AI_DESIGN // AI ile oluÅŸturulmuÅŸ tasarÄ±m (henÃ¼z Ã¼reticiye gÃ¶nderilmedi)
  PENDING_APPROVAL // Ãœretici onayÄ± bekleniyor (eski flow iÃ§in)
  PENDING // Beklemede - Yeni talep

  // === Ä°NCELEME ve TEKLÄ°F AÅžAMASI ===
  REVIEWED // Ãœretici tarafÄ±ndan inceleniyor
  QUOTE_SENT // Ãœretici sÃ¼re ve fiyat teklifi gÃ¶nderdi
  CUSTOMER_QUOTE_SENT // MÃ¼ÅŸteri teklif gÃ¶nderdi (standart veya revize)
  MANUFACTURER_REVIEWING_QUOTE // Ãœretici mÃ¼ÅŸteri teklifini inceliyor

  // === ONAY/RED DURUMLAR ===
  CONFIRMED // MÃ¼ÅŸteri onayladÄ±, Ã¼retim baÅŸlayabilir
  REJECTED // Genel red
  REJECTED_BY_CUSTOMER // MÃ¼ÅŸteri tarafÄ±ndan reddedildi
  REJECTED_BY_MANUFACTURER // Ãœretici tarafÄ±ndan reddedildi

  // === ÃœRETÄ°M AÅžAMALARI ===
  IN_DESIGN // TasarÄ±m aÅŸamasÄ±nda (eski flow)
  PATTERN_READY // KalÄ±p hazÄ±r (eski flow)
  IN_PRODUCTION // Ãœretim aÅŸamasÄ±nda
  PRODUCTION_COMPLETE // Ãœretim tamamlandÄ±

  // === KALÄ°TE ve TESLÄ°MAT ===
  QUALITY_CHECK // Kalite kontrolde
  SHIPPED // Kargoya verildi
  DELIVERED // MÃ¼ÅŸteriye teslim edildi

  // === DÄ°ÄžER DURUMLAR ===
  ON_HOLD // Durduruldu (geÃ§ici olarak askÄ±ya alÄ±ndÄ±)
  CANCELLED // Ä°ptal edildi

  // === ESKÄ° FLOW Ä°Ã‡Ä°N (Geriye dÃ¶nÃ¼k uyumluluk) ===
  REQUESTED // MÃ¼ÅŸteri tarafÄ±ndan talep edildi (eski)
  RECEIVED // Ãœretici talebi aldÄ± (eski)
  COMPLETED // TamamlandÄ± (eski - artÄ±k DELIVERED kullanÄ±lÄ±yor)
}

enum OrderStatus {
  PENDING // SipariÅŸ beklemede
  REVIEWED // Ãœretici tarafÄ±ndan inceleniyor
  QUOTE_SENT // Ãœretici sÃ¼re ve fiyat teklifi gÃ¶nderdi
  CUSTOMER_QUOTE_SENT // MÃ¼ÅŸteri teklif gÃ¶nderdi (standart veya revize)
  MANUFACTURER_REVIEWING_QUOTE // Ãœretici mÃ¼ÅŸteri teklifini inceliyor
  CONFIRMED // MÃ¼ÅŸteri sipariÅŸi onayladÄ±
  REJECTED // SipariÅŸ reddedildi
  REJECTED_BY_CUSTOMER // MÃ¼ÅŸteri tarafÄ±ndan reddedildi
  REJECTED_BY_MANUFACTURER // Ãœretici tarafÄ±ndan reddedildi
  IN_PRODUCTION // Ãœretim aÅŸamasÄ±nda
  PRODUCTION_COMPLETE // Ãœretim tamamlandÄ±
  QUALITY_CHECK // Kalite kontrolÃ¼ yapÄ±lÄ±yor
  SHIPPED // Kargoya verildi
  DELIVERED // MÃ¼ÅŸteriye teslim edildi
  CANCELLED // Ä°ptal edildi
}

model File {
  id          String   @id @default(cuid())
  filename    String
  path        String
  size        Int
  mimetype    String
  encoding    String?
  description String?
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt

  @@map("files")
}

// Production Stage Updates
model ProductionStageUpdate {
  id           Int                @id @default(autoincrement())
  production   ProductionTracking @relation(fields: [productionId], references: [id], onDelete: Cascade)
  productionId Int

  stage           ProductionStage
  status          StageStatus     @default(NOT_STARTED)
  actualStartDate DateTime?
  actualEndDate   DateTime?
  estimatedDays   Int?
  notes           String?         @db.Text
  photos          String?         @db.Text // JSON array
  isRevision      Boolean         @default(false)
  delayReason     String?         @db.Text // Gecikme sebebi
  extraDays       Int             @default(0)

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@map("production_stage_updates")
}

// Quality Control
model QualityControl {
  id           Int                @id @default(autoincrement())
  production   ProductionTracking @relation(fields: [productionId], references: [id], onDelete: Cascade)
  productionId Int
  inspector    User               @relation("QualityInspector", fields: [inspectorId], references: [id])
  inspectorId  Int

  checkDate DateTime      @default(now())
  result    QualityResult @default(PENDING)
  score     Int? // 1-100 puan
  notes     String?       @db.Text
  photos    String?       @db.Text // JSON: defect photos

  // Hata kategorileri
  fabricDefects    Boolean @default(false)
  sewingDefects    Boolean @default(false)
  measureDefects   Boolean @default(false)
  finishingDefects Boolean @default(false)

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@map("quality_controls")
}

// Workshop
model Workshop {
  id       Int          @id @default(autoincrement())
  name     String       @unique
  type     WorkshopType
  capacity Int? // GÃ¼nlÃ¼k kapasite
  location String?
  isActive Boolean      @default(true)

  owner   User @relation("WorkshopOwner", fields: [ownerId], references: [id])
  ownerId Int

  sewingProductions    ProductionTracking[] @relation("SewingWorkshop")
  packagingProductions ProductionTracking[] @relation("PackagingWorkshop")

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@map("workshops")
}

// ========================================
// UNIFIED LIBRARY SYSTEM (Simplified & Scalable)
// ========================================

enum LibraryCategory {
  COLOR         // Renk paleti
  FABRIC        // KumaÅŸ kÃ¼tÃ¼phanesi
  MATERIAL      // Aksesuar/Malzemeler (Button, Zipper, Label, etc.)
  SIZE_GROUP    // Beden gruplarÄ±
  SEASON        // Sezon yÃ¶netimi
  FIT           // Kesim tipleri
  CERTIFICATION // Sertifikalar
}

enum LibraryScope {
  PLATFORM_STANDARD  // Platform geneli standart (admin tanÄ±mlÄ±)
  COMPANY_CUSTOM     // Firma Ã¶zel
}

// Unified Library Item - TÃ¼m library tiplerini kapsayan tek model
model LibraryItem {
  id       Int            @id @default(autoincrement())
  scope    LibraryScope   @default(COMPANY_CUSTOM)
  category LibraryCategory

  // Universal Fields (Her kategori iÃ§in ortak)
  code        String?  @unique
  name        String   // i18n key or direct name (frontend handles translations)

  description String?  @db.Text
  imageUrl    String?  @db.Text

  // Category-Specific Data (JSON - Esnek yapÄ±)
  data        Json?    // {
  //   // For COLOR:
  //   "pantone": "PANTONE 18-3838",
  //   "hex": "#FFFFFF",
  //   "rgb": "rgb(255,255,255)",
  //   "cmyk": "cmyk(0,0,0,0)",
  //   "ral": "RAL 9016",
  //   "category": "NEUTRAL",
  //   "season": "ALL",
  //
  //   // For FABRIC:
  //   "composition": "%100 Cotton",
  //   "weight": 180,
  //   "width": 150,
  //   "fiberType": "COTTON",
  //   "construction": "Plain Weave",
  //   "texture": "Smooth",
  //   "finish": "Raw",
  //   "usage": "Shirts",
  //   "season": "ALL",
  //   "certifications": ["GOTS", "OEKO-TEX"],
  //   "supplier": "ABC Fabrics",
  //   "supplierCode": "SUP-001",
  //   "price": 15.50,
  //   "currency": "USD",
  //   "minOrder": 100,
  //   "leadTime": 15,
  //
  //   // For MATERIAL:
  //   "materialType": "Metal",
  //   "size": "15mm",
  //   "color": "Gold",
  //   "brand": "YKK",
  //   "subCategory": "BUTTON",
  //   "finish": "Matte",
  //   "supplier": "XYZ Accessories",
  //   "price": 0.50,
  //   "minOrder": 1000,
  //
  //   // For SIZE_GROUP:
  //   "sizes": ["XS", "S", "M", "L", "XL"],
  //   "sizeCategory": "MEN",
  //
  //   // For SEASON:
  //   "year": 2025,
  //   "type": "SS",
  //   "fullName": "Spring/Summer 2025",
  //   "startDate": "2025-01-01",
  //   "endDate": "2025-06-30",
  //
  //   // For FIT:
  //   "fitCategory": "UPPER",
  //
  //   // For CERTIFICATION:
  //   "certCategory": "FIBER",
  //   "issuer": "GOTS International",
  //   "validFrom": "2024-01-01",
  //   "validUntil": "2025-12-31",
  //   "certificateNumber": "GOTS-2024-001",
  //   "certificateFile": "/uploads/certs/gots.pdf"
  // }

  // Common Metadata
  tags        Json?    // ["white", "basic", "neutral"]
  internalCode String? // Firma iÃ§i referans kodu
  notes       String?  @db.Text

  // Status
  isActive    Boolean  @default(true)
  isPopular   Boolean  @default(false)

  // Relations
  company     Company? @relation("CompanyLibraryItems", fields: [companyId], references: [id], onDelete: Cascade)
  companyId   Int?

  // Standard Reference (Company items can reference platform standards)
  standardItem   LibraryItem?  @relation("StandardReference", fields: [standardItemId], references: [id])
  standardItemId Int?
  companyItems   LibraryItem[] @relation("StandardReference")

  // ðŸ”— Certification Relations (Many-to-Many)
  // Bu item'Ä±n sahip olduÄŸu sertifikalar (Fabric/Color/Material â†’ Certifications)
  certifications     LibraryItem[] @relation("ItemCertifications")
  // Bu sertifikanÄ±n atandÄ±ÄŸÄ± item'lar (Certification â†’ Fabric/Color/Material)
  certifiedItems     LibraryItem[] @relation("ItemCertifications")

  // Collections using certifications
  collections Collection[] @relation("CollectionCertifications")

  createdBy   User?    @relation("LibraryItemCreator", fields: [createdById], references: [id])
  createdById Int?

  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt

  @@unique([companyId, category, name])
  @@index([scope, category])
  @@index([companyId, category, isActive])
  @@index([category, isActive, isPopular])
  @@index([standardItemId])
  @@index([code])
  @@fulltext([name, description])
  @@map("library_items")
}

// ========================================

// Production Revisions
model ProductionRevision {
  id           Int                @id @default(autoincrement())
  production   ProductionTracking @relation(fields: [productionId], references: [id], onDelete: Cascade)
  productionId Int

  reason      String
  description String? @db.Text
  extraDays   Int     @default(0)
  extraCost   Float   @default(0)
  isApproved  Boolean @default(false)

  requestedBy   User @relation("RevisionRequester", fields: [requestedById], references: [id])
  requestedById Int

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@map("production_revisions")
}

// Production Enums
enum ProductionStage {
  PLANNING
  FABRIC
  CUTTING
  SEWING
  QUALITY
  PACKAGING
  SHIPPING
}

enum StageStatus {
  NOT_STARTED
  IN_PROGRESS
  ON_HOLD
  COMPLETED
  REQUIRES_REVISION
}

enum ProductionStatus {
  IN_PROGRESS
  WAITING
  BLOCKED
  COMPLETED
  CANCELLED
}

enum QualityResult {
  PENDING
  PASSED
  FAILED
  CONDITIONAL_PASS
}

enum WorkshopType {
  SEWING
  PACKAGING
  QUALITY_CONTROL
  GENERAL
}

// ========================================
// NOTIFICATION SYSTEM
// ========================================

enum NotificationType {
  ORDER // SipariÅŸ bildirimleri
  SAMPLE // Numune bildirimleri
  MESSAGE // Mesaj bildirimleri
  PRODUCTION // Ãœretim bildirimleri
  QUALITY // Kalite kontrol bildirimleri
  SYSTEM // Sistem bildirimleri
  USER_MANAGEMENT // KullanÄ±cÄ± yÃ¶netimi bildirimleri
}

model Notification {
  id      Int              @id @default(autoincrement())
  type    NotificationType
  title   String
  message String           @db.Text
  link    String?          // Ä°lgili sayfanÄ±n URL'i
  isRead  Boolean          @default(false)

  // Ä°liÅŸkiler
  userId Int
  user   User @relation("UserNotifications", fields: [userId], references: [id], onDelete: Cascade)

  // Ä°lgili kayÄ±tlar (opsiyonel)
  orderId            Int?
  order              Order?              @relation("OrderNotifications", fields: [orderId], references: [id], onDelete: Cascade)
  sampleId           Int?
  sample             Sample?             @relation("SampleNotifications", fields: [sampleId], references: [id], onDelete: Cascade)
  productionTrackingId Int?
  productionTracking ProductionTracking? @relation("ProductionNotifications", fields: [productionTrackingId], references: [id], onDelete: Cascade)

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@index([userId, isRead])
  @@index([userId, createdAt])
  @@map("notifications")
}

// ========================================
// Task Model - MÃ¼ÅŸteri/KullanÄ±cÄ± AksiyonlarÄ±
// ========================================

enum TaskStatus {
  TODO // YapÄ±lmasÄ± gerekenler
  IN_PROGRESS // Devam ediyor
  COMPLETED // TamamlandÄ±
  CANCELLED // Ä°ptal edildi
}

enum TaskPriority {
  LOW // DÃ¼ÅŸÃ¼k Ã¶ncelik
  MEDIUM // Orta Ã¶ncelik
  HIGH // YÃ¼ksek Ã¶ncelik
}

enum TaskType {
  // === STATUS BAZLI GÃ–REVLER (Dinamik) ===
  STATUS_CHANGE // Status deÄŸiÅŸikliÄŸi gerektiren gÃ¶rev (SampleStatus, OrderStatus ile iliÅŸkili)

  // === Ã–ZEL GÃ–REV TÄ°PLERÄ° ===
  QUOTATION // Fiyat teklifi hazÄ±rla/gÃ¶nder
  REVIEW_QUOTE // Teklifi incele (mÃ¼ÅŸteri veya Ã¼retici)
  APPROVE_REJECT // Onay/Red aksiyonu gerekli
  PAYMENT // Ã–deme iÅŸlemi
  DOCUMENT // Belge/DokÃ¼man iÅŸlemi

  // === ÃœRETÄ°M SÃœRECÄ° GÃ–REVLER ===
  PRODUCTION_STAGE // Ãœretim aÅŸama gÃ¶revleri (ProductionStage ile iliÅŸkili)
  QUALITY_CHECK // Kalite kontrol gÃ¶revi
  SHIPMENT // Kargo/Sevkiyat iÅŸlemi
  MATERIAL // Malzeme tedarik/kontrol

  // === GENEL GÃ–REVLER ===
  MEETING // ToplantÄ±
  REVISION // Revize talebi
  NOTIFICATION // Bilgilendirme (aksiyon gerektirmeyen)
  DEADLINE_WARNING // Termin uyarÄ±sÄ±
  OTHER // DiÄŸer
}

model Task {
  id            Int      @id @default(autoincrement())
  title         String   // GÃ¶rev baÅŸlÄ±ÄŸÄ± (Ã¶rn: "Teklif OnayÄ± Bekliyor")
  description   String?  @db.LongText // DetaylÄ± aÃ§Ä±klama
  status        TaskStatus @default(TODO)
  priority      TaskPriority @default(MEDIUM)
  type          TaskType

  // STATUS Ä°LÄ°ÅžKÄ°SÄ° - Hangi status iÃ§in bu task oluÅŸturuldu
  relatedStatus String? // "QUOTE_SENT", "CUSTOMER_QUOTE_SENT", vb.
  targetStatus  String? // Hedef status (bu task tamamlandÄ±ÄŸÄ±nda gidilecek status)
  entityType    String? // "ORDER", "SAMPLE", "PRODUCTION" - Hangi entity iÃ§in

  // ÃœRETÄ°M AÅžAMASI Ä°LÄ°ÅžKÄ°SÄ°
  productionStage String? // "PLANNING", "FABRIC", "CUTTING", vb. (ProductionStage enum deÄŸeri)

  // KullanÄ±cÄ± ve Ä°liÅŸkilendirmeler
  userId        Int      // GÃ¶revin oluÅŸturduÄŸu kullanÄ±cÄ± (mÃ¼ÅŸteri veya Ã¼retici)
  user          User     @relation("UserTasks", fields: [userId], references: [id], onDelete: Cascade)

  // GÃ¶zlemci (Ãœretici taraf iÃ§in gelen gÃ¶revlerde atanan kiÅŸi)
  assignedToId  Int?     // Kime atanÄ±yor (null ise kendisine atanmÄ±ÅŸ)
  assignedTo    User?    @relation("AssignedTasks", fields: [assignedToId], references: [id], onDelete: SetNull)

  // Opsiyonel Ä°liÅŸkiler
  collectionId  Int?     // Koleksiyonla ilgili gÃ¶rev
  collection    Collection? @relation("CollectionTasks", fields: [collectionId], references: [id], onDelete: SetNull)

  sampleId      Int?     // Ã–rnek talebesiyle ilgili gÃ¶rev
  sample        Sample?  @relation("SampleTasks", fields: [sampleId], references: [id], onDelete: SetNull)

  orderId       Int?     // SipariÅŸ talebesiyle ilgili gÃ¶rev
  order         Order?   @relation("OrderTasks", fields: [orderId], references: [id], onDelete: SetNull)

  productionTrackingId Int?
  productionTracking ProductionTracking? @relation("ProductionTrackingTasks", fields: [productionTrackingId], references: [id], onDelete: SetNull)

  // Tarihler
  dueDate       DateTime? // Son teslim tarihi
  completedAt   DateTime? // Tamamlanma tarihi
  createdAt     DateTime @default(now())
  updatedAt     DateTime @updatedAt

  // Metadata
  notes         String?  @db.LongText // Notlar
  assignedBy    Int? // Kimin tarafÄ±ndan atandÄ±ÄŸÄ±

  // Aksiyon Metadata (JSON)
  actionData    Json? // Aksiyonla ilgili ekstra data: {buttonText, endpoint, requiredFields, etc.}

  @@index([userId, status])
  @@index([userId, dueDate])
  @@index([status, priority])
  @@index([relatedStatus]) // Status bazlÄ± filtreleme iÃ§in
  @@index([entityType, relatedStatus]) // Entity ve status kombinasyonu
  @@index([createdAt])
  @@map("tasks")
}

// ========================================
// COMPANY PARTNERSHIPS & CROSS-BRAND COLLABORATION
// ========================================

enum PartnershipType {
  SUPPLIER          // TedarikÃ§i iliÅŸkisi (kumaÅŸ, aksesuar, vb.)
  MANUFACTURER      // Ãœretici ortaklÄ±ÄŸÄ±
  DISTRIBUTOR       // DistribÃ¼tÃ¶r iliÅŸkisi
  WHITE_LABEL       // White label Ã¼retim
  CO_BRANDING       // Ortak marka iÅŸbirliÄŸi
  SUBCONTRACTOR     // Fason Ã¼retici
  STRATEGIC_PARTNER // Stratejik iÅŸ ortaÄŸÄ±
}

enum PartnershipStatus {
  PENDING      // Onay bekliyor
  ACTIVE       // Aktif ortaklÄ±k
  SUSPENDED    // AskÄ±ya alÄ±nmÄ±ÅŸ
  TERMINATED   // SonlandÄ±rÄ±lmÄ±ÅŸ
  REJECTED     // ReddedilmiÅŸ
}

// Firmalar ArasÄ± OrtaklÄ±k/EÅŸleÅŸtirme Sistemi
model CompanyPartnership {
  id          Int               @id @default(autoincrement())

  // Ä°ki taraflÄ± iliÅŸki
  company     Company           @relation("CompanyAsInitiator", fields: [companyId], references: [id], onDelete: Cascade)
  companyId   Int

  partner     Company           @relation("CompanyAsPartner", fields: [partnerId], references: [id], onDelete: Cascade)
  partnerId   Int

  type        PartnershipType
  status      PartnershipStatus @default(PENDING)

  // OrtaklÄ±k DetaylarÄ±
  title       String            // "KumaÅŸ Tedarik AnlaÅŸmasÄ±", "Fason Ãœretim OrtaklÄ±ÄŸÄ±"
  description String?           @db.Text
  terms       Json?             // AnlaÅŸma koÅŸullarÄ±: { paymentTerms, deliveryTerms, qualityStandards, etc. }

  // Finansal Bilgiler
  contractValue     Float?      // AnlaÅŸma deÄŸeri
  currency          String?     @default("USD")
  paymentTerms      String?     // "NET 30", "NET 60", "Advance Payment"

  // Tarihler
  startDate         DateTime?
  endDate           DateTime?
  renewalDate       DateTime?

  // Performans & Ä°statistikler
  totalOrders       Int         @default(0)
  totalRevenue      Float       @default(0)
  averageLeadTime   Int?        // Ortalama teslim sÃ¼resi (gÃ¼n)
  qualityScore      Float?      // 1-10 arasÄ± kalite skoru
  onTimeDelivery    Float?      // ZamanÄ±nda teslimat oranÄ± (%)

  // Notlar ve DÃ¶kÃ¼manlar
  notes             String?     @db.Text
  contractFile      String?     // SÃ¶zleÅŸme PDF
  nda               Boolean     @default(false) // NDA imzalandÄ± mÄ±?

  // Kategori EÅŸleÅŸtirmeleri
  categoryMappings  SharedCategoryMapping[]

  // Ä°letiÅŸim
  initiatedBy       User?       @relation(fields: [initiatedById], references: [id])
  initiatedById     Int?

  approvedBy        User?       @relation("PartnershipApprover", fields: [approvedById], references: [id])
  approvedById      Int?

  createdAt         DateTime    @default(now())
  updatedAt         DateTime    @updatedAt

  @@unique([companyId, partnerId, type])
  @@index([companyId, status])
  @@index([partnerId, status])
  @@index([type, status])
  @@index([status, startDate])
  @@map("company_partnerships")
}

// Markalar ArasÄ± Kategori EÅŸleÅŸtirme (Kategori Uyumu)
model SharedCategoryMapping {
  id          Int       @id @default(autoincrement())

  // OrtaklÄ±k iliÅŸkisi
  partnership CompanyPartnership @relation(fields: [partnershipId], references: [id], onDelete: Cascade)
  partnershipId Int

  // Birinci firmanÄ±n kategorisi
  sourceCompany     Company         @relation("SourceCategoryCompany", fields: [sourceCompanyId], references: [id], onDelete: Cascade)
  sourceCompanyId   Int
  sourceCategory    CompanyCategory @relation("SourceCategory", fields: [sourceCategoryId], references: [id], onDelete: Cascade)
  sourceCategoryId  Int

  // Ä°kinci firmanÄ±n eÅŸleÅŸen kategorisi
  targetCompany     Company         @relation("TargetCategoryCompany", fields: [targetCompanyId], references: [id], onDelete: Cascade)
  targetCompanyId   Int
  targetCategory    CompanyCategory @relation("TargetCategory", fields: [targetCategoryId], references: [id], onDelete: Cascade)
  targetCategoryId  Int

  // EÅŸleÅŸtirme DetaylarÄ±
  matchScore        Float?          // Otomatik hesaplanan benzerlik skoru (0-100)
  isManualMapping   Boolean         @default(false) // Manuel eÅŸleÅŸtirme mi, otomatik mi?
  isActive          Boolean         @default(true)

  // Ã‡apraz Ä°ÅŸlem AyarlarÄ±
  allowCrossOrders  Boolean         @default(true)  // Bu kategoriler arasÄ± sipariÅŸ alÄ±nabilir mi?
  priceAdjustment   Float?          @default(0)     // Fiyat ayarlamasÄ± (% olarak)
  notes             String?         @db.Text

  createdBy         User?           @relation(fields: [createdById], references: [id])
  createdById       Int?

  createdAt         DateTime        @default(now())
  updatedAt         DateTime        @updatedAt

  @@unique([sourceCategoryId, targetCategoryId])
  @@index([partnershipId])
  @@index([sourceCompanyId])
  @@index([targetCompanyId])
  @@index([isActive])
  @@map("shared_category_mappings")
}

// ========================================
// ADMIN ANALYTICS & COMPARISON SYSTEM
// ========================================

enum ReportType {
  COMPANY_COMPARISON    // Firma karÅŸÄ±laÅŸtÄ±rma raporu
  PERFORMANCE           // Performans raporu
  FINANCIAL             // Finansal rapor
  QUALITY               // Kalite raporu
  MARKET_ANALYSIS       // Pazar analizi
  TREND_ANALYSIS        // Trend analizi
  CUSTOM                // Ã–zel rapor
}

enum ReportPeriod {
  DAILY
  WEEKLY
  MONTHLY
  QUARTERLY
  YEARLY
  CUSTOM
}

// Admin Raporlama ve Analiz Sistemi
model AdminReport {
  id            Int          @id @default(autoincrement())

  type          ReportType
  period        ReportPeriod
  title         String
  description   String?      @db.Text

  // Tarih AralÄ±ÄŸÄ±
  startDate     DateTime
  endDate       DateTime

  // Ä°lgili Firmalar
  companies     Json         // Array of company IDs: [1, 2, 3, ...]

  // Rapor Verileri
  metrics       Json         // { totalOrders, totalRevenue, avgLeadTime, qualityScore, etc. }
  charts        Json?        // Grafik verileri
  summary       String?      @db.Text
  insights      String?      @db.Text // AI-powered insights

  // KÄ±yaslama Verileri
  comparisons   Json?        // Firma kÄ±yaslama verileri
  rankings      Json?        // SÄ±ralama verileri
  benchmarks    Json?        // SektÃ¶r ortalamalarÄ±

  // Dosya
  reportFile    String?      // PDF/Excel export

  // OluÅŸturan
  createdBy     User         @relation(fields: [createdById], references: [id])
  createdById   Int

  // PaylaÅŸÄ±m
  isPublic      Boolean      @default(false)
  sharedWith    Json?        // User/Company IDs ile paylaÅŸÄ±m

  createdAt     DateTime     @default(now())
  updatedAt     DateTime     @updatedAt

  @@index([type, period])
  @@index([createdById])
  @@index([startDate, endDate])
  @@index([createdAt])
  @@map("admin_reports")
}

// Firma Performans Metrikleri (Real-time tracking)
model CompanyMetrics {
  id            Int      @id @default(autoincrement())

  company       Company  @relation(fields: [companyId], references: [id], onDelete: Cascade)
  companyId     Int

  // Tarih
  date          DateTime @default(now())
  period        ReportPeriod @default(DAILY)

  // SipariÅŸ Metrikleri
  totalOrders          Int      @default(0)
  completedOrders      Int      @default(0)
  cancelledOrders      Int      @default(0)
  pendingOrders        Int      @default(0)
  orderCompletionRate  Float?   // %

  // Finansal Metrikleri
  totalRevenue         Float    @default(0)
  averageOrderValue    Float?
  totalProfit          Float?
  profitMargin         Float?   // %

  // Ãœretim Metrikleri
  totalSamples         Int      @default(0)
  approvedSamples      Int      @default(0)
  sampleApprovalRate   Float?   // %
  averageLeadTime      Int?     // gÃ¼n
  onTimeDeliveryRate   Float?   // %

  // Kalite Metrikleri
  qualityScore         Float?   // 1-10
  defectRate           Float?   // %
  returnRate           Float?   // %
  customerSatisfaction Float?   // 1-10

  // MÃ¼ÅŸteri/Partner Metrikleri
  activeCustomers      Int      @default(0)
  newCustomers         Int      @default(0)
  retainedCustomers    Int      @default(0)
  customerRetentionRate Float?  // %

  // Verimlilik Metrikleri
  capacityUtilization  Float?   // %
  productivityScore    Float?   // 1-10
  employeeCount        Int?

  // Platform KullanÄ±mÄ±
  activeUsers          Int      @default(0)
  loginCount           Int      @default(0)
  featureUsage         Json?    // { samples: 50, orders: 30, messages: 100 }

  createdAt            DateTime @default(now())
  updatedAt            DateTime @updatedAt

  @@unique([companyId, date, period])
  @@index([companyId, date])
  @@index([period, date])
  @@index([date])
  @@map("company_metrics")
}

// ========================================
