# üöÄ SaaS Readiness Analizi - Textile Production System

## üìä Mevcut Durum: SaaS Uygunluk Deƒüerlendirmesi

### ‚úÖ MEVCUT G√ú√áL√ú Y√ñNLER (SaaS Ready)

#### 1. Multi-Tenancy ‚úÖ (Temel Seviye)
```prisma
model Company {
  id Int @id
  type CompanyType // MANUFACTURER, BUYER, BOTH
  // ... Her ≈üirket kendi datasƒ±na eri≈üir
}

model User {
  companyId Int? // Tenant isolation
  role Role
}

model Sample {
  companyId Int? // Tenant-specific data
}
```
**Durum:** ‚úÖ Company-based isolation var, ancak eksiklikler var

---

#### 2. Role-Based Access Control (RBAC) ‚úÖ
```prisma
enum Role {
  ADMIN
  COMPANY_OWNER
  COMPANY_EMPLOYEE
  INDIVIDUAL_CUSTOMER
  // ...
}

model User {
  role Role
  permissions Json? // Flexible permissions
  isCompanyOwner Boolean
  department String?
}
```
**Durum:** ‚úÖ ƒ∞yi, ancak daha sistemli olabilir

---

#### 3. Audit Trail ‚úÖ (Kƒ±smi)
```prisma
model Sample {
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
}

model SampleProduction {
  createdAt DateTime
  updatedBy User
}
```
**Durum:** ‚ö†Ô∏è Var ama eksik (kim ne deƒüi≈ütirdi takibi yok)

---

#### 4. Soft Delete ‚ö†Ô∏è (Partial)
```prisma
model User {
  isActive Boolean @default(true)
}

model Company {
  isActive Boolean @default(true)
}
```
**Durum:** ‚ö†Ô∏è `deletedAt` ve `deletedBy` yok

---

#### 5. Notification System ‚úÖ
```prisma
model Notification {
  type NotificationType
  userId Int
  // ...
}
```
**Durum:** ‚úÖ ƒ∞yi tasarlanmƒ±≈ü

---

#### 6. Task Management ‚úÖ
```prisma
model Task {
  type TaskType
  status TaskStatus
  priority TaskPriority
  // Dynamic task system
}
```
**Durum:** ‚úÖ M√ºkemmel - 700+ satƒ±r dinamik sistem

---

### ‚ùå EKSƒ∞K OLANLAR (SaaS ƒ∞√ßin Kritik)

#### 1. ‚ö†Ô∏è Subscription & Billing System (KRƒ∞Tƒ∞K EKSƒ∞K!)

**Sorun:** SaaS'ƒ±n kalbi yok!

```prisma
// ‚ùå MEVCUT: YOK

// ‚úÖ GEREKLƒ∞:
enum SubscriptionPlan {
  FREE
  STARTER
  PROFESSIONAL
  ENTERPRISE
  CUSTOM
}

enum SubscriptionStatus {
  ACTIVE
  TRIAL
  PAST_DUE
  CANCELLED
  EXPIRED
}

model Subscription {
  id            Int      @id @default(autoincrement())
  companyId     Int      @unique
  company       Company  @relation(fields: [companyId], references: [id])

  plan          SubscriptionPlan
  status        SubscriptionStatus @default(TRIAL)

  // Pricing
  monthlyPrice  Float
  yearlyPrice   Float?
  currency      String   @default("USD")

  // Billing cycle
  billingCycle  String   @default("MONTHLY") // MONTHLY, YEARLY
  currentPeriodStart DateTime
  currentPeriodEnd   DateTime

  // Trial
  trialStart    DateTime?
  trialEnd      DateTime?

  // Cancellation
  cancelAt      DateTime?
  canceledAt    DateTime?

  // Usage limits
  limits        Json? // { users: 10, samples: 100, orders: 50 }

  createdAt     DateTime @default(now())
  updatedAt     DateTime @updatedAt

  // Relations
  invoices      Invoice[]
  usageRecords  UsageRecord[]

  @@index([companyId])
  @@index([status])
  @@index([currentPeriodEnd])
}

model Invoice {
  id              Int      @id @default(autoincrement())
  invoiceNumber   String   @unique
  subscriptionId  Int
  subscription    Subscription @relation(fields: [subscriptionId], references: [id])

  // Amount
  amount          Float
  tax             Float    @default(0)
  total           Float
  currency        String   @default("USD")

  // Status
  status          String   // DRAFT, OPEN, PAID, VOID, UNCOLLECTIBLE
  paidAt          DateTime?

  // Period
  periodStart     DateTime
  periodEnd       DateTime

  // Payment
  paymentMethod   String?  // CREDIT_CARD, BANK_TRANSFER, PAYPAL
  paidAmount      Float    @default(0)

  // Files
  pdfUrl          String?

  createdAt       DateTime @default(now())
  updatedAt       DateTime @updatedAt

  @@index([subscriptionId])
  @@index([status])
  @@index([createdAt])
}

model UsageRecord {
  id             Int      @id @default(autoincrement())
  subscriptionId Int
  subscription   Subscription @relation(fields: [subscriptionId], references: [id])

  // Metrics
  metric         String   // "samples", "orders", "users", "storage_gb"
  quantity       Int
  timestamp      DateTime @default(now())

  // Limits check
  isOverLimit    Boolean  @default(false)

  @@index([subscriptionId, metric])
  @@index([timestamp])
}
```

**Etki:** üî¥ CRITICAL - SaaS olmadan SaaS yok!

---

#### 2. ‚ö†Ô∏è Usage Limits & Quotas (KRƒ∞Tƒ∞K EKSƒ∞K!)

**Sorun:** Kullanƒ±m limiti kontrol√º yok

```prisma
// ‚ùå MEVCUT: YOK

// ‚úÖ GEREKLƒ∞:
model PlanLimit {
  id             Int      @id @default(autoincrement())
  plan           SubscriptionPlan

  // Limits
  maxUsers       Int?     // null = unlimited
  maxSamples     Int?
  maxOrders      Int?
  maxCollections Int?
  maxStorageGB   Float?

  // Features
  hasAIDesign    Boolean  @default(false)
  hasAnalytics   Boolean  @default(false)
  hasAPI         Boolean  @default(false)
  hasPriority    Boolean  @default(false)

  // Support
  supportLevel   String   // COMMUNITY, EMAIL, PRIORITY, DEDICATED

  createdAt      DateTime @default(now())
  updatedAt      DateTime @updatedAt

  @@unique([plan])
}

// Usage tracking
model CompanyUsage {
  id             Int      @id @default(autoincrement())
  companyId      Int      @unique
  company        Company  @relation(fields: [companyId], references: [id])

  // Current usage
  userCount      Int      @default(0)
  sampleCount    Int      @default(0)
  orderCount     Int      @default(0)
  storageUsedGB  Float    @default(0)

  // Last calculated
  lastCalculated DateTime @default(now())

  @@index([companyId])
}
```

---

#### 3. ‚ö†Ô∏è Payment Integration (EKSƒ∞K!)

**Sorun:** √ñdeme sistemi yok

```prisma
// ‚úÖ GEREKLƒ∞:
model PaymentMethod {
  id             Int      @id @default(autoincrement())
  companyId      Int
  company        Company  @relation(fields: [companyId], references: [id])

  type           String   // CREDIT_CARD, BANK_ACCOUNT, PAYPAL
  provider       String   // STRIPE, PAYPAL, BANK

  // Card info (encrypted/tokenized)
  last4          String?
  brand          String?  // VISA, MASTERCARD
  expiryMonth    Int?
  expiryYear     Int?

  // Status
  isDefault      Boolean  @default(false)
  isValid        Boolean  @default(true)

  // Provider references
  stripeCustomerId       String?
  stripePaymentMethodId  String?

  createdAt      DateTime @default(now())
  updatedAt      DateTime @updatedAt

  @@index([companyId])
}

model Payment {
  id             Int      @id @default(autoincrement())
  invoiceId      Int
  invoice        Invoice  @relation(fields: [invoiceId], references: [id])

  amount         Float
  currency       String   @default("USD")
  status         String   // PENDING, COMPLETED, FAILED, REFUNDED

  // Provider
  provider       String   // STRIPE, PAYPAL
  providerTransactionId String?

  // Timestamps
  paidAt         DateTime?
  failedAt       DateTime?
  refundedAt     DateTime?

  // Error
  errorMessage   String?

  createdAt      DateTime @default(now())
  updatedAt      DateTime @updatedAt

  @@index([invoiceId])
  @@index([status])
}
```

---

#### 4. ‚ö†Ô∏è Feature Flags (EKSƒ∞K!)

**Sorun:** A/B testing ve feature rollout yok

```prisma
// ‚úÖ GEREKLƒ∞:
model Feature {
  id             Int      @id @default(autoincrement())
  key            String   @unique // "ai_design_v2", "new_dashboard"
  name           String
  description    String?
  isEnabled      Boolean  @default(false)

  // Rollout
  rolloutPercent Int      @default(0) // 0-100

  // Targeting
  allowedPlans   String?  // JSON: ["PROFESSIONAL", "ENTERPRISE"]
  allowedCompanies String? // JSON: [123, 456]

  createdAt      DateTime @default(now())
  updatedAt      DateTime @updatedAt

  @@index([key])
  @@index([isEnabled])
}

model CompanyFeatureOverride {
  id             Int      @id @default(autoincrement())
  companyId      Int
  company        Company  @relation(fields: [companyId], references: [id])
  featureKey     String
  isEnabled      Boolean

  createdAt      DateTime @default(now())

  @@unique([companyId, featureKey])
  @@index([companyId])
}
```

---

#### 5. ‚ö†Ô∏è Analytics & Metrics (ZAYIF!)

**Sorun:** Business metrics tracking yok

```prisma
// ‚úÖ GEREKLƒ∞:
model CompanyMetrics {
  id             Int      @id @default(autoincrement())
  companyId      Int
  company        Company  @relation(fields: [companyId], references: [id])
  date           DateTime @db.Date

  // Usage metrics
  activeUsers    Int      @default(0)
  samplesCreated Int      @default(0)
  ordersPlaced   Int      @default(0)

  // Revenue metrics (manufacturer i√ßin)
  revenue        Float    @default(0)

  // Engagement metrics
  loginCount     Int      @default(0)

  createdAt      DateTime @default(now())

  @@unique([companyId, date])
  @@index([companyId, date])
}

// Event tracking
model Event {
  id             Int      @id @default(autoincrement())
  companyId      Int?
  userId         Int?

  eventType      String   // "sample_created", "order_placed", "login"
  eventData      Json?

  // Context
  ipAddress      String?
  userAgent      String?

  timestamp      DateTime @default(now())

  @@index([companyId, eventType])
  @@index([userId, eventType])
  @@index([timestamp])
}
```

---

#### 6. ‚ö†Ô∏è API Keys & Webhooks (EKSƒ∞K!)

**Sorun:** External integration i√ßin API yok

```prisma
// ‚úÖ GEREKLƒ∞:
model ApiKey {
  id             Int      @id @default(autoincrement())
  companyId      Int
  company        Company  @relation(fields: [companyId], references: [id])

  name           String
  key            String   @unique
  secret         String   // Hashed

  // Permissions
  scopes         String   // JSON: ["read:samples", "write:orders"]

  // Status
  isActive       Boolean  @default(true)
  lastUsedAt     DateTime?

  // Expiry
  expiresAt      DateTime?

  createdAt      DateTime @default(now())
  updatedAt      DateTime @updatedAt

  @@index([companyId])
  @@index([key])
}

model Webhook {
  id             Int      @id @default(autoincrement())
  companyId      Int
  company        Company  @relation(fields: [companyId], references: [id])

  url            String
  events         String   // JSON: ["sample.created", "order.updated"]
  secret         String   // For signature verification

  isActive       Boolean  @default(true)

  // Stats
  successCount   Int      @default(0)
  failureCount   Int      @default(0)
  lastTriggeredAt DateTime?

  createdAt      DateTime @default(now())
  updatedAt      DateTime @updatedAt

  @@index([companyId])
}

model WebhookDelivery {
  id             Int      @id @default(autoincrement())
  webhookId      Int
  webhook        Webhook  @relation(fields: [webhookId], references: [id])

  event          String   // "sample.created"
  payload        Json

  // Response
  statusCode     Int?
  responseBody   String?

  // Status
  success        Boolean  @default(false)
  attemptCount   Int      @default(1)

  createdAt      DateTime @default(now())
  deliveredAt    DateTime?

  @@index([webhookId])
  @@index([createdAt])
}
```

---

#### 7. ‚ö†Ô∏è Tenant Isolation Enhancement (GELƒ∞≈ûTƒ∞Rƒ∞LMELƒ∞!)

**Sorun:** Row-level security yeterli deƒüil

```prisma
// ‚úÖ ƒ∞Yƒ∞LE≈ûTƒ∞RME:
model Company {
  // ... mevcut fields

  // Tenant metadata
  subdomain      String?  @unique // acme.yoursaas.com
  customDomain   String?  @unique // acme.com

  // Settings
  branding       Json?    // { logo, colors, etc. }
  features       Json?    // Enabled features per tenant

  // Security
  ipWhitelist    String?  // JSON array
  ssoEnabled     Boolean  @default(false)
  ssoConfig      Json?

  // Status
  status         String   @default("ACTIVE") // ACTIVE, SUSPENDED, CANCELLED
  suspendedAt    DateTime?
  suspendedReason String?

  @@index([subdomain])
  @@index([status])
}
```

---

#### 8. ‚ö†Ô∏è Compliance & GDPR (EKSƒ∞K!)

**Sorun:** Data privacy ve compliance yok

```prisma
// ‚úÖ GEREKLƒ∞:
model DataExportRequest {
  id             Int      @id @default(autoincrement())
  userId         Int
  user           User     @relation(fields: [userId], references: [id])

  status         String   // PENDING, PROCESSING, COMPLETED, FAILED
  format         String   // JSON, CSV, PDF

  // Files
  fileUrl        String?
  expiresAt      DateTime?

  requestedAt    DateTime @default(now())
  completedAt    DateTime?

  @@index([userId])
  @@index([status])
}

model DataDeletionRequest {
  id             Int      @id @default(autoincrement())
  userId         Int
  user           User     @relation(fields: [userId], references: [id])

  status         String   // PENDING, APPROVED, COMPLETED
  reason         String?

  requestedAt    DateTime @default(now())
  approvedAt     DateTime?
  completedAt    DateTime?

  @@index([userId])
  @@index([status])
}

model AuditLog {
  id             Int      @id @default(autoincrement())
  companyId      Int
  userId         Int?

  action         String   // "CREATE", "UPDATE", "DELETE"
  resource       String   // "Sample", "Order", "User"
  resourceId     Int?

  // Changes
  oldValues      Json?
  newValues      Json?

  // Context
  ipAddress      String?
  userAgent      String?

  timestamp      DateTime @default(now())

  @@index([companyId, timestamp])
  @@index([userId, timestamp])
  @@index([resource, resourceId])
}
```

---

### üìä SaaS Readiness Score

| Kategori | Durum | Skor |
|----------|-------|------|
| **Multi-Tenancy** | ‚ö†Ô∏è Temel var | 6/10 |
| **Subscription & Billing** | ‚ùå Yok | 0/10 |
| **Usage Limits** | ‚ùå Yok | 0/10 |
| **Payment Integration** | ‚ùå Yok | 0/10 |
| **RBAC** | ‚úÖ ƒ∞yi | 7/10 |
| **Audit Trail** | ‚ö†Ô∏è Kƒ±smi | 4/10 |
| **Analytics** | ‚ö†Ô∏è Zayƒ±f | 3/10 |
| **API & Webhooks** | ‚ùå Yok | 0/10 |
| **Feature Flags** | ‚ùå Yok | 0/10 |
| **Compliance (GDPR)** | ‚ùå Yok | 0/10 |

**TOPLAM:** **20/100** üî¥

---

## üéØ SaaS'a D√∂n√º≈üt√ºrme Roadmap

### Phase 1: Foundation (2-3 hafta) üî¥ CRITICAL
```
‚úÖ 1. Subscription & Billing System
   - Subscription model
   - Invoice model
   - Usage tracking

‚úÖ 2. Plan Limits
   - Plan definition
   - Quota enforcement
   - Usage monitoring

‚úÖ 3. Payment Integration
   - Stripe integration
   - Payment method storage
   - Webhook handling
```

### Phase 2: Security & Compliance (2 hafta) üü° HIGH
```
‚úÖ 4. Enhanced Tenant Isolation
   - Subdomain support
   - Custom domain
   - Row-level security

‚úÖ 5. Audit Logging
   - Full audit trail
   - Change tracking
   - Compliance reporting

‚úÖ 6. GDPR Compliance
   - Data export
   - Data deletion
   - Consent management
```

### Phase 3: Integration & Extensibility (2 hafta) üü° HIGH
```
‚úÖ 7. API Keys & Webhooks
   - API key management
   - Webhook system
   - Event streaming

‚úÖ 8. Feature Flags
   - Feature management
   - A/B testing
   - Gradual rollout
```

### Phase 4: Analytics & Optimization (1-2 hafta) üü¢ MEDIUM
```
‚úÖ 9. Analytics & Metrics
   - Business metrics
   - Usage analytics
   - Custom dashboards

‚úÖ 10. Performance Optimization
   - Caching strategy
   - Database optimization
   - CDN integration
```

---

## üí° Hƒ±zlƒ± Ba≈ülangƒ±√ß - ƒ∞lk 3 G√ºn

### Day 1: Subscription Model
```prisma
// En basit haliyle ba≈üla
model Subscription {
  id        Int      @id @default(autoincrement())
  companyId Int      @unique
  company   Company  @relation(fields: [companyId], references: [id])
  plan      String   @default("FREE") // FREE, PRO, ENTERPRISE
  status    String   @default("ACTIVE")

  currentPeriodEnd DateTime

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
}
```

### Day 2: Usage Limits
```typescript
// Middleware ile kontrol et
export async function checkUsageLimits(companyId: number, resource: string) {
  const subscription = await prisma.subscription.findUnique({
    where: { companyId }
  });

  const limits = PLAN_LIMITS[subscription.plan];
  const usage = await getResourceCount(companyId, resource);

  if (usage >= limits[resource]) {
    throw new Error('Usage limit exceeded. Please upgrade your plan.');
  }
}
```

### Day 3: Billing Page
```typescript
// Basit bir billing sayfasƒ±
<SubscriptionCard
  currentPlan="FREE"
  usage={{ samples: 5, maxSamples: 10 }}
  onUpgrade={() => navigate('/billing/upgrade')}
/>
```

---

## üìà Beklenen ROI

### Mevcut Durum (SaaS deƒüil)
- ‚ùå Recurring revenue yok
- ‚ùå Self-service onboarding yok
- ‚ùå Scalability sƒ±nƒ±rlƒ±
- ‚ùå Usage tracking yok

### SaaS Sonrasƒ± (3 ay i√ßinde)
- ‚úÖ Monthly Recurring Revenue (MRR)
- ‚úÖ Self-service signup + trial
- ‚úÖ Otomatik billing
- ‚úÖ Usage-based pricing
- ‚úÖ Scalable architecture
- ‚úÖ Analytics & insights

**Tahmin:**
- MRR: $0 ‚Üí $5,000+ (3 ay)
- Customer Acquisition Cost: -70%
- Churn Rate: %20 ‚Üí %5

---

## üöÄ Sonu√ß

### Mevcut Durum:
üìä **SaaS Readiness: 20/100**

Domain-specific √∂zellikler (Sample, Order, Production) m√ºkemmel ‚úÖ
SaaS fundamentals eksik ‚ùå

### √ñneri:
1. **Phase 1'i acilen ba≈ülat** (Subscription + Billing)
2. **2 hafta i√ßinde** temel SaaS features ekle
3. **1 ay i√ßinde** ilk paying customer'ƒ± al

### ƒ∞lk Adƒ±m:
```bash
# 1. Subscription migration olu≈ütur
npx prisma migrate dev --name add_subscription_system

# 2. Stripe entegrasyonu
npm install stripe @stripe/stripe-js

# 3. Billing page olu≈ütur
# pages/billing.tsx
```

---

**Karar:** Schema domain problemi m√ºkemmel √ß√∂z√ºyor, ama SaaS olmadan sadece custom software!

**≈ûimdi ne yapmalƒ±?** Phase 1'i ba≈ülatalƒ±m mƒ±? (Subscription + Billing) üöÄ

---

**Hazƒ±rlayan:** SaaS Architecture Team
**Tarih:** 18 Ekim 2025
**Status:** üî¥ CRITICAL - Immediate action required
