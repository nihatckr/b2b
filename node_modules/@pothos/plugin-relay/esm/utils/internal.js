import { PothosValidationError } from '@pothos/core';
import { decodeGlobalID, encodeGlobalID } from './global-ids.js';
export function internalEncodeGlobalID(builder, typename, id, ctx) {
    var _builder_options_relay;
    if ((_builder_options_relay = builder.options.relay) === null || _builder_options_relay === void 0 ? void 0 : _builder_options_relay.encodeGlobalID) {
        return builder.options.relay.encodeGlobalID(typename, id, ctx);
    }
    return encodeGlobalID(typename, id);
}
export function internalDecodeGlobalID(builder, globalID, ctx, info, parseIdsForTypes) {
    var _builder_options_relay;
    const decoded = ((_builder_options_relay = builder.options.relay) === null || _builder_options_relay === void 0 ? void 0 : _builder_options_relay.decodeGlobalID) ? builder.options.relay.decodeGlobalID(globalID, ctx) : decodeGlobalID(globalID);
    if (Array.isArray(parseIdsForTypes)) {
        const entry = parseIdsForTypes.find(({ typename }) => typename === decoded.typename);
        if (!entry) {
            throw new PothosValidationError(`ID: ${globalID} is not of type: ${parseIdsForTypes.map(({ typename }) => typename).join(", ")}`);
        }
        if (entry.parseId) {
            return {
                ...decoded,
                id: entry.parseId(decoded.id, ctx)
            };
        }
        return decoded;
    }
    if (parseIdsForTypes) {
        var _info_schema_getType_extensions, _info_schema_getType;
        const parseID = (_info_schema_getType = info.schema.getType(decoded.typename)) === null || _info_schema_getType === void 0 ? void 0 : (_info_schema_getType_extensions = _info_schema_getType.extensions) === null || _info_schema_getType_extensions === void 0 ? void 0 : _info_schema_getType_extensions.pothosParseGlobalID;
        if (parseID) {
            return {
                ...decoded,
                id: parseID(decoded.id, ctx)
            };
        }
    }
    return decoded;
}
//# sourceMappingURL=internal.js.map
