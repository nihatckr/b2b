{"version":3,"sources":["../src/request-cache.ts"],"names":["createContextCache","isThenable","PothosValidationError","AuthScopeFailureType","cacheKey","canCache","contextCache","ctx","builder","RequestCache","fromContext","context","clearForContext","delete","getScopes","scopes","options","scopeAuth","authScopes","then","resolved","withScopes","cb","resolvedScopes","saveGrantedScopes","path","key","grantCache","has","set","get","scope","add","Set","testGrantedScopes","prev","grantTypeScopes","type","parent","typeGrants","Map","cache","result","evaluateScopeLoader","name","arg","scopeCache","loader","String","bind","treatErrorsAsUnauthorized","error","kind","AuthScope","parameter","promise","r","catch","evaluateScopeMapWithScopes","$all","$any","$granted","map","info","forAll","scopeNames","Object","keys","problems","failure","AllAuthScopes","AnyAuthScopes","failures","loaderList","scopeName","push","promises","GrantedScope","anyResult","evaluateScopeMap","allResult","resolveAndReturn","loaderName","length","Promise","all","results","hasSuccess","val","defaultStrategy","AuthScopeFunction","mapCache","evaluateTypeScopeFunction","typeCache"],"mappings":"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"}