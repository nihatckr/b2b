"use strict";
Object.defineProperty(exports, "__esModule", {
    value: true
});
function _export(target, all) {
    for(var name in all)Object.defineProperty(target, name, {
        enumerable: true,
        get: Object.getOwnPropertyDescriptor(all, name).get
    });
}
_export(exports, {
    get findUniqueMap () {
        return findUniqueMap;
    },
    get getDelegateFromModel () {
        return getDelegateFromModel;
    },
    get getFieldData () {
        return getFieldData;
    },
    get getModel () {
        return getModel;
    },
    get getRefFromModel () {
        return getRefFromModel;
    },
    get getRelation () {
        return getRelation;
    },
    get includeForRefMap () {
        return includeForRefMap;
    },
    get refMap () {
        return refMap;
    }
});
const _core = require("@pothos/core");
const _interfaceref = require("../interface-ref");
const _objectref = require("../object-ref");
const _getclient = require("./get-client");
const refMap = new WeakMap();
const findUniqueMap = new WeakMap();
const includeForRefMap = new WeakMap();
function getRefFromModel(name, builder, type = 'object') {
    if (!refMap.has(builder)) {
        refMap.set(builder, new Map());
    }
    const cache = refMap.get(builder);
    if (!cache.has(name)) {
        cache.set(name, type === 'object' ? new _objectref.PrismaObjectRef(name, name) : new _interfaceref.PrismaInterfaceRef(name, name));
    }
    return cache.get(name);
}
function getRelation(name, builder, relation) {
    const fieldData = getFieldData(name, builder, relation);
    if (fieldData.kind !== 'object') {
        throw new _core.PothosSchemaError(`Field ${relation} of model '${name}' is not a relation (${fieldData.kind})`);
    }
    return fieldData;
}
function getFieldData(name, builder, fieldName) {
    const modelData = getModel(name, builder);
    const fieldData = modelData.fields.find((field)=>field.name === fieldName);
    if (!fieldData) {
        throw new _core.PothosSchemaError(`Field '${fieldName}' not found in model '${name}'`);
    }
    return fieldData;
}
function getModel(name, builder) {
    const dmmf = (0, _getclient.getDMMF)(builder);
    const modelData = Array.isArray(dmmf.models) ? dmmf.models.find((model)=>model.name === name) : dmmf.models[name];
    if (!modelData) {
        throw new _core.PothosSchemaError(`Model '${name}' not found in DMMF`);
    }
    return modelData;
}
function getDelegateFromModel(client, model) {
    const lowerCase = `${model.slice(0, 1).toLowerCase()}${model.slice(1)}`;
    const delegate = lowerCase in client ? client[lowerCase] : null;
    if (!delegate) {
        throw new _core.PothosSchemaError(`Unable to find delegate for model ${model}`);
    }
    return delegate;
}

//# sourceMappingURL=datamodel.js.map