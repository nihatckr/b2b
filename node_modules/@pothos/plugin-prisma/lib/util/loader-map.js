"use strict";
Object.defineProperty(exports, "__esModule", {
    value: true
});
function _export(target, all) {
    for(var name in all)Object.defineProperty(target, name, {
        enumerable: true,
        get: Object.getOwnPropertyDescriptor(all, name).get
    });
}
_export(exports, {
    get cacheKey () {
        return cacheKey;
    },
    get getLoaderMapping () {
        return getLoaderMapping;
    },
    get setLoaderMappings () {
        return setLoaderMappings;
    }
});
const _core = require("@pothos/core");
const cache = (0, _core.createContextCache)(()=>new Map());
function cacheKey(type, path, subPath = []) {
    let key = '';
    let current = path;
    while(current){
        if (typeof current.key === 'string') {
            key = key ? `${current.key}.${key}` : current.key;
        }
        current = current.prev;
    }
    for (const entry of subPath){
        key = `${key}.${entry}`;
    }
    return `${type}@${key}`;
}
function setLoaderMappings(ctx, info, value) {
    const map = cache(ctx);
    for (const [field, mapping] of Object.entries(value)){
        const subPath = [
            ...mapping.indirectPath,
            field
        ];
        const key = cacheKey(mapping.type, info.path, subPath);
        map.set(key, mapping.mappings);
    }
}
function getLoaderMapping(ctx, path, type) {
    const map = cache(ctx);
    const key = cacheKey(type, path, []);
    var _map_get;
    return (_map_get = map.get(key)) !== null && _map_get !== void 0 ? _map_get : null;
}

//# sourceMappingURL=loader-map.js.map